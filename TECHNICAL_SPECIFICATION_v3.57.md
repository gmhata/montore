# å•è¨ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ  Ver3.57 æŠ€è¡“ä»•æ§˜æ›¸

**æœ€çµ‚æ›´æ–°æ—¥**: 2024å¹´11æœˆ16æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.57ï¼ˆVer3ã‚·ãƒªãƒ¼ã‚ºå®Œæˆç‰ˆï¼‰  
**ã‚·ã‚¹ãƒ†ãƒ å**: çœ‹è­·æ•™è‚²ç”¨AIå•è¨ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼  

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ](#3-ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ )
4. [ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±](#4-ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±)
5. [è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ï¼‰](#5-è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯)
6. [ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ãƒ»èº«ä½“è¨ºå¯Ÿåˆ¤å®š](#6-ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³èº«ä½“è¨ºå¯Ÿåˆ¤å®š)
7. [AIã‚³ãƒ¼ãƒæ©Ÿèƒ½](#7-aiã‚³ãƒ¼ãƒæ©Ÿèƒ½)
8. [ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—](#8-ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—)
9. [ã‚³ã‚¹ãƒˆæ§‹é€ ](#9-ã‚³ã‚¹ãƒˆæ§‹é€ )
10. [ã‚·ã‚¹ãƒ†ãƒ å¤‰æ›´å±¥æ­´](#10-ã‚·ã‚¹ãƒ†ãƒ å¤‰æ›´å±¥æ­´)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ç›®çš„

çœ‹è­·å­¦ç”ŸãŒå•è¨ºæŠ€è¡“ã‚’ç¿’å¾—ã™ã‚‹ãŸã‚ã®AIé§†å‹•å‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã€‚å­¦ç”Ÿã¯ä»®æƒ³æ‚£è€…ï¼ˆAIï¼‰ã¨ã®éŸ³å£°å¯¾è©±ã‚’é€šã˜ã¦ã€è‡¨åºŠç¾å ´ã§å¿…è¦ãªå•è¨ºã‚¹ã‚­ãƒ«ã‚’ç·´ç¿’ã—ã€å³åº§ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

### 1.2 ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ä½œæˆ** | æ•™å“¡ãŒä»»æ„ã®æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆå¯èƒ½ |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±** | OpenAI Realtime APIã«ã‚ˆã‚‹è‡ªç„¶ãªä¼šè©± |
| **è‡ªå‹•è©•ä¾¡** | 9é …ç›®ã®ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ã«åŸºã¥ãå®¢è¦³çš„è©•ä¾¡ |
| **ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®š** | éŸ³å£°èªè­˜ã«ã‚ˆã‚‹è‡ªå‹•åˆ¤å®š |
| **èº«ä½“è¨ºå¯Ÿèªè­˜** | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è¨ºå¯Ÿé …ç›®æ¤œå‡º |
| **AIã‚³ãƒ¼ãƒ** | å­¦ç¿’å±¥æ­´ã«åŸºã¥ãå€‹åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ |
| **å­¦ä¿®å±¥æ­´ç®¡ç†** | å…¨å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¨˜éŒ²ã¨åˆ†æ |

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|---------|------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | HTML5, JavaScript (ES6+), CSS3 |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | Node.js, Express.js |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Google Cloud Firestore |
| **èªè¨¼** | Firebase Authentication |
| **AI/ML** | OpenAI GPT-4o Realtime API, GPT-4o-mini |
| **éŸ³å£°** | Web Speech API, WebRTC |
| **ã‚¤ãƒ³ãƒ•ãƒ©** | Google Cloud Run, Cloud Build |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†** | GitHub |

---

## 2. æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå­¦ç”Ÿãƒ»æ•™å“¡ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Google Cloud Run                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Express.js Server (server.js)            â”‚  â”‚
â”‚  â”‚  - REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                              â”‚  â”‚
â”‚  â”‚  - Firebase Admin SDK                                 â”‚  â”‚
â”‚  â”‚  - OpenAI APIçµ±åˆ                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Static File Serving (public/)                â”‚  â”‚
â”‚  â”‚  - index.html                                         â”‚  â”‚
â”‚  â”‚  - practice.js (å¯¾è©±ãƒ­ã‚¸ãƒƒã‚¯)                          â”‚  â”‚
â”‚  â”‚  - admin.js (ç®¡ç†ç”»é¢)                                 â”‚  â”‚
â”‚  â”‚  - auth.js (èªè¨¼)                                      â”‚  â”‚
â”‚  â”‚  - assets/ (å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Firestore   â”‚ â”‚   Firebase   â”‚ â”‚   OpenAI API    â”‚
â”‚   Database    â”‚ â”‚     Auth     â”‚ â”‚  - Realtime API â”‚
â”‚               â”‚ â”‚              â”‚ â”‚  - Chat API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æµã‚Œ

```
1. ãƒ­ã‚°ã‚¤ãƒ³ (Firebase Auth)
   â†“
2. æ‚£è€…é¸æŠç”»é¢
   â†“
3. ã€Œã“ã®æ‚£è€…ã§å¯¾è©±é–‹å§‹ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
   â†“
4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ (Firestore: sessions)
   â†“
5. Ephemeral Tokenå–å¾— (OpenAI Sessions API)
   â†“
6. WebRTCæ¥ç¶šç¢ºç«‹ (OpenAI Realtime API)
   â†“
7. éŸ³å£°å¯¾è©±ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ï¼‰
   - çœ‹è­·å¸«éŸ³å£° â†’ OpenAI â†’ æ‚£è€…AIéŸ³å£°
   - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºï¼ˆãƒã‚¤ã‚¿ãƒ«ãƒ»è¨ºå¯Ÿï¼‰
   - ä¼šè©±è¨˜éŒ²ï¼ˆFirestoreæ›´æ–°ï¼‰
   â†“
8. ã€Œè©•ä¾¡ã«é€²ã‚€ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
   â†“
9. WebRTCåˆ‡æ–­
   â†“
10. è©•ä¾¡ç”Ÿæˆ (GPT-4o-mini)
    â†“
11. çµæœä¿å­˜ (Firestore: sessionsæ›´æ–°)
    â†“
12. è©•ä¾¡ç”»é¢è¡¨ç¤º
```

### 2.3 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
webapp/
â”œâ”€â”€ server.js                      # ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ (123KB)
â”œâ”€â”€ package.json                   # ä¾å­˜é–¢ä¿‚å®šç¾©
â”œâ”€â”€ Dockerfile                     # ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å®šç¾©
â”œâ”€â”€ cloudbuild-dev.yaml           # CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®šç¾©
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html                # ãƒ¡ã‚¤ãƒ³HTML (60KB)
â”‚   â”œâ”€â”€ auth.js                   # Firebaseèªè¨¼ (3.3KB)
â”‚   â”œâ”€â”€ practice.js               # å¯¾è©±ãƒ­ã‚¸ãƒƒã‚¯ (155KB)
â”‚   â”œâ”€â”€ admin.js                  # ç®¡ç†ç”»é¢ (133KB)
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ patient_idle.mp4      # å¾…æ©Ÿå‹•ç”» (367KB)
â”‚       â””â”€â”€ patient_speaking.mp4  # ç™ºè©±å‹•ç”» (3.6MB)
â””â”€â”€ TECHNICAL_SPECIFICATION_v3.57.md  # æœ¬æ–‡æ›¸
```

**é‡è¦ãªå¤‰æ›´ï¼ˆv3.57ï¼‰**:
- Ver2ã®å›ºå®šæ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ï¼ˆpatients/001-010/ï¼‰ã‚’å®Œå…¨å‰Šé™¤
- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰å‹•ç”»ã‚·ã‚¹ãƒ†ãƒ ï¼ˆpractice/ï¼‰ã‚’å®Œå…¨å‰Šé™¤
- æœªä½¿ç”¨JSãƒ•ã‚¡ã‚¤ãƒ«6å€‹ã‚’å‰Šé™¤ï¼ˆsimulator.js, api-demo.jsç­‰ï¼‰
- åˆè¨ˆ78ãƒ•ã‚¡ã‚¤ãƒ«ã€137MBå‰Šæ¸›
- ã‚·ãƒ³ãƒ—ãƒ«ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®é«˜ã„æ§‹æˆã«çµ±ä¸€

---

## 3. ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ 

### 3.1 æ¦‚è¦

Ver3.57ã§ã¯ã€**ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ã®ã¿**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚æ•™å“¡ãŒç®¡ç†ç”»é¢ã‹ã‚‰è‡ªç”±ã«æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã§ãã‚‹ã€‚

### 3.2 æ‚£è€…ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**Firestoreã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**: `test_patients`

```javascript
{
  id: "QNvmhCT6p9V7DgvVb7F4",              // Firestore Document ID
  patientNo: 23,                          // æ‚£è€…ç•ªå·ï¼ˆè¡¨ç¤ºç”¨ï¼‰
  name: "ä½è—¤ ç¾å’²",                       // æ‚£è€…å
  ageBand: "å¤§äºº",                         // å¹´é½¢å¸¯: "å­ä¾›" | "å¤§äºº" | "é«˜é½¢è€…"
  gender: "å¥³æ€§",                          // æ€§åˆ¥: "ç”·æ€§" | "å¥³æ€§"
  language: "ja",                          // è¨€èª: "ja" | "en" | "ko" | "zh"
  brokenJapanese: false,                   // ã‚«ã‚¿ã‚³ãƒˆæ—¥æœ¬èªãƒ•ãƒ©ã‚°
  profile: "45æ­³å¥³æ€§ã€‚3æ—¥å‰ã‹ã‚‰èƒ¸éƒ¨ã«...",  // æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆè©³ç´°ï¼‰
  timeLimit: 180,                          // åˆ¶é™æ™‚é–“ï¼ˆç§’ï¼‰
  active: true,                            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°
  isPublic: true,                          // å…¬é–‹ãƒ•ãƒ©ã‚°
  createdAt: Timestamp,                    // ä½œæˆæ—¥æ™‚
  createdBy: "user@example.com",          // ä½œæˆè€…
  
  // ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³è¨­å®šï¼ˆã‚«ã‚¹ã‚¿ãƒ å¯èƒ½ï¼‰
  expectedVitals: {
    temperature: {
      value: "37.8",
      unit: "â„ƒ",
      label: "ä½“æ¸©",
      normal: false
    },
    bloodPressure: {
      value: "140/90",
      unit: "mmHg",
      label: "è¡€åœ§",
      normal: false
    },
    pulse: {
      value: "95",
      unit: "å›/åˆ†",
      label: "è„ˆæ‹",
      normal: false
    },
    // ... ãã®ä»–ã®ãƒã‚¤ã‚¿ãƒ«
  },
  
  // ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¤ã‚¿ãƒ«é …ç›®ï¼ˆä»»æ„è¿½åŠ å¯èƒ½ï¼‰
  customVitals: {
    custom1: {
      value: "18",
      unit: "å›/åˆ†",
      label: "å‘¼å¸æ•°",
      normal: true,
      custom: true
    }
  }
}
```

### 3.3 æ‚£è€…ä½œæˆãƒ•ãƒ­ãƒ¼

#### æ‰‹å‹•ä½œæˆ

1. ç®¡ç†ç”»é¢ â†’ ã€Œæ‚£è€…ç®¡ç†ã€ã‚¿ãƒ–
2. ã€Œ+ æ–°è¦æ‚£è€…ä½œæˆã€ãƒœã‚¿ãƒ³
3. ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›:
   - åŸºæœ¬æƒ…å ±ï¼ˆåå‰ã€å¹´é½¢å¸¯ã€æ€§åˆ¥ã€è¨€èªï¼‰
   - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆç—‡çŠ¶ãƒ»ç—…æ­´ï¼‰
   - ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³å€¤
   - ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¤ã‚¿ãƒ«é …ç›®ï¼ˆä»»æ„ï¼‰
4. ã€Œä¿å­˜ã€â†’ Firestoreã«ä¿å­˜

#### AIç”Ÿæˆ

1. ã€ŒAIã§ç”Ÿæˆã€ãƒœã‚¿ãƒ³ï¼ˆç®¡ç†ç”»é¢ï¼‰
2. ç°¡å˜ãªæ¡ä»¶æŒ‡å®šï¼ˆæ€§åˆ¥ã€å¹´é½¢å¸¯ã€ç—‡çŠ¶ã‚«ãƒ†ã‚´ãƒªï¼‰
3. OpenAI GPT-4oãŒãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è‡ªå‹•ç”Ÿæˆ
4. ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç¢ºèªãƒ»ç·¨é›†
5. ä¿å­˜

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/admin/patients/generate`

```javascript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
{
  gender: "å¥³æ€§",
  ageBand: "å¤§äºº",
  scenario: "chest"  // chest | head | abdomen | respiratory
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆGPT-4oãŒç”Ÿæˆï¼‰
{
  name: "ç”°ä¸­ ç¥å­",
  age: 52,
  gender: "å¥³æ€§",
  ageBand: "å¤§äºº",
  profile: "52æ­³å¥³æ€§ã€‚æ˜¨å¤œã‹ã‚‰çªç„¶ã®èƒ¸ç—›ãŒå‡ºç¾ã—..."
}
```

### 3.4 å‹•ç”»ã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€

Ver3.57ã§ã¯ã€**å…¨æ‚£è€…ãŒåŒã˜ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ç”»ã‚’ä½¿ç”¨**:

```javascript
// practice.js Line 787-792
function videosForExam(no){ 
  console.log(`[videosForExam] Patient No.${no}: Using default videos`);
  return VIDEO_SRC_FALLBACK;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ç”»ã‚’è¿”ã™
}

const VIDEO_SRC_FALLBACK = {
  idle: "/assets/patient_idle.mp4",       // å¾…æ©ŸçŠ¶æ…‹ï¼ˆ367KBï¼‰
  speaking: "/assets/patient_speaking.mp4" // ç™ºè©±çŠ¶æ…‹ï¼ˆ3.6MBï¼‰
};
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… ã‚·ã‚¹ãƒ†ãƒ ãŒã‚·ãƒ³ãƒ—ãƒ«
- âœ… æ–°è¦æ‚£è€…è¿½åŠ ã«å‹•ç”»ä¸è¦
- âœ… ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆå‰Šæ¸›
- âœ… ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡å‰Šæ¸›ï¼ˆ137MBå‰Šæ¸›ï¼‰

---

## 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±

### 4.1 æŠ€è¡“ä»•æ§˜

| é …ç›® | ä»•æ§˜ |
|------|------|
| **AI ãƒ¢ãƒ‡ãƒ«** | gpt-4o-realtime-preview-2024-12-17 |
| **æ¥ç¶šæ–¹å¼** | WebRTC over OpenAI Realtime API |
| **éŸ³å£°å…¥åŠ›** | ãƒã‚¤ã‚¯ï¼ˆgetUserMediaï¼‰ |
| **éŸ³å£°å‡ºåŠ›** | ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ï¼ˆHTMLAudioElementï¼‰ |
| **æ–‡å­—èµ·ã“ã—** | OpenAI Realtime + Web Speech APIï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ |
| **è¨€èªã‚µãƒãƒ¼ãƒˆ** | æ—¥æœ¬èªã€è‹±èªã€éŸ“å›½èªã€ä¸­å›½èª |

### 4.2 å¯¾è©±é–‹å§‹ãƒ•ãƒ­ãƒ¼

```javascript
// practice.js Line 1307-1336
async function startWithSelectedPatient() {
  // 1. æ‚£è€…ãƒ‡ãƒ¼ã‚¿å–å¾—
  const patient = selectedPatientData;
  
  // 2. å‹•ç”»ã‚½ãƒ¼ã‚¹è¨­å®š
  window.__VIDEO_SRC = videosForExam(patient.patientNo);
  
  // 3. å¯¾è©±é–‹å§‹
  await startTalk({
    mode: "test",
    patient: {
      id: patient.id,
      no: patient.patientNo,
      name: patient.name,
      expectedVitals: patient.expectedVitals,
      customVitals: patient.customVitals
    },
    persona: {
      name: patient.name,
      ageBand: patient.ageBand,
      gender: patient.gender,
      language: patient.language,
      brokenJapanese: patient.brokenJapanese,
      profileSeed: patient.profile
    },
    timeLimit: patient.timeLimit || 180  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3åˆ†
  });
}
```

### 4.3 OpenAI Realtime API æ¥ç¶š

#### Ephemeral Tokenå–å¾—

```javascript
// server.js Line 328-335
app.post("/session", requireAuth, async (req, res) => {
  const response = await openaiFetch(
    "https://api.openai.com/v1/realtime/sessions",
    {
      method: "POST",
      headers: { "OpenAI-Beta": "realtime=v1" },
      body: JSON.stringify({
        model: "gpt-4o-realtime-preview-2024-12-17",
        voice: req.body.voice  // "shimmer" | "echo" | "alloy" | "verse"
      })
    }
  );
  
  const ephemeralKey = response.client_secret.value;
  res.json({ ephemeralKey });
});
```

#### WebRTCæ¥ç¶šç¢ºç«‹

```javascript
// practice.js Line 1596-1866
// 1. PeerConnectionä½œæˆ
pc = new RTCPeerConnection({
  iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
});

// 2. ãƒã‚¤ã‚¯ãƒˆãƒ©ãƒƒã‚¯è¿½åŠ 
pc.addTransceiver(micStream.getAudioTracks()[0], {
  direction: "sendrecv"
});

// 3. OpenAIã¸SDPã‚ªãƒ•ã‚¡ãƒ¼é€ä¿¡
const offer = await pc.createOffer();
await pc.setLocalDescription(offer);

const sdpResp = await fetch(
  "https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-12-17",
  {
    method: "POST",
    headers: {
      Authorization: `Bearer ${EPHEMERAL_TOKEN}`,
      "Content-Type": "application/sdp",
      "OpenAI-Beta": "realtime=v1"
    },
    body: offer.sdp
  }
);

// 4. SDPã‚¢ãƒ³ã‚µãƒ¼å—ä¿¡
const answerSdp = await sdpResp.text();
await pc.setRemoteDescription({
  type: "answer",
  sdp: answerSdp
});

// 5. æ¥ç¶šå®Œäº†
```

### 4.4 AIãƒšãƒ«ã‚½ãƒŠè¨­å®šï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰

æ‚£è€…AIã®æŒ¯ã‚‹èˆã„ã¯è©³ç´°ãªã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§åˆ¶å¾¡ã•ã‚Œã‚‹ï¼š

```javascript
// practice.js Line 2425-2642
function buildInstructions({ name, ageBand, gender, lang, brokenJapanese, profile }) {
  return `
ã‚ãªãŸã¯åŒ»ç™‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨“ç·´ã«ãŠã‘ã‚‹ã€Œæ¨¡æ“¬æ‚£è€…ã€ã§ã™ã€‚

ã€åŸºæœ¬è¨­å®šã€‘
- åå‰: ${name}
- å¹´é½¢å¸¯: ${ageBand}
- æ€§åˆ¥: ${gender}
- è¨€èª: ${langName}
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«: ${profile}

ã€é‡è¦ãƒ«ãƒ¼ãƒ«ã€‘

1. VITAL SIGNS AND PHYSICAL EXAMINATION - CRITICAL RULES:
   âš ï¸ NEVER volunteer vital sign information
   âš ï¸ You DO NOT KNOW your vital signs unless measured
   âš ï¸ NEVER state specific numbers for vital signs
   
   âœ“ COOPERATION WITH MEASUREMENTS:
   - "ä½“æ¸©ã‚’æ¸¬ã‚‰ã›ã¦ãã ã•ã„" â†’ "ã¯ã„" or "ã¯ã„ã€ãŠé¡˜ã„ã—ã¾ã™"
   - "è¡€åœ§ã‚’æ¸¬ã‚Šã¾ã—ã‚‡ã†" â†’ "ã¯ã„" or "ã‚ã‹ã‚Šã¾ã—ãŸ"
   - "è´è¨ºã•ã›ã¦ãã ã•ã„" â†’ "ã¯ã„" or "ã©ã†ã"
   - Be cooperative and accept immediately
   - Remember: You are a patient who wants to be examined

2. YOUR FIRST RESPONSE:
   âš ï¸ Keep it VERY SHORT (5-10 words maximum)
   âš ï¸ Only mention your MAIN complaint briefly
   âš ï¸ Example: "èƒ¸ãŒç—›ã„ã§ã™â€¦"
   âš ï¸ DO NOT provide detailed symptoms yet
   âš ï¸ Wait for nurse to ask specific questions

3. STRICTLY FORBIDDEN TOPICS:
   âŒ "How are you?" / "Nice weather" / Small talk
   âŒ Hobbies, interests, entertainment, sports
   âŒ Non-medical conversations
   
4. RESPONSE STYLE:
   âœ“ Use natural, conversational ${langName}
   âœ“ Show emotions appropriate to your condition
   âœ“ Pause naturally, don't rush
   âœ“ If in pain, show discomfort in voice
   âœ“ Keep responses concise (1-3 sentences usually)
   
5. LANGUAGE-SPECIFIC BEHAVIOR:
   ${brokenJapanese ? `
   âš ï¸ ã‚ãªãŸã®æ—¥æœ¬èªã¯ä¸å®Œå…¨ã§ã™ï¼ˆã‚«ã‚¿ã‚³ãƒˆï¼‰
   - åŠ©è©ã‚’æ™‚ã€…çœç•¥: "ç§ã¯" â†’ "ç§"
   - ç°¡å˜ãªå˜èªã‚’ä½¿ã†
   - æ–‡æ³•ã¯ä¸å®Œå…¨ã§OK
   ` : ''}
   
6. INFORMATION DISCLOSURE:
   âœ“ Answer questions honestly based on your profile
   âœ“ Provide details only when asked
   âœ“ If you don't have information, say "ã‚ã‹ã‚Šã¾ã›ã‚“"
   âœ“ Never invent information not in your profile
  `;
}
```

**ä¸»è¦ãªè¨­è¨ˆæ–¹é‡**:
1. **å”åŠ›çš„æ…‹åº¦**: ãƒã‚¤ã‚¿ãƒ«æ¸¬å®šãƒ»è¨ºå¯Ÿã«ç©æ¥µçš„ã«å¿œã˜ã‚‹
2. **æ®µéšçš„é–‹ç¤º**: æœ€åˆã¯ç°¡æ½”ã«ã€è³ªå•ã«å¿œã˜ã¦è©³ç´°ã‚’è©±ã™
3. **ç¾å®Ÿçš„åˆ¶ç´„**: è‡ªåˆ†ã®ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã¯çŸ¥ã‚‰ãªã„
4. **è¨€èªå¿ å®Ÿæ€§**: æŒ‡å®šè¨€èªã®ã¿ä½¿ç”¨
5. **åŒ»ç™‚ç„¦ç‚¹**: é›‘è«‡ã‚’é¿ã‘ã€ç—‡çŠ¶ã«é›†ä¸­

---

## 5. è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ï¼‰

### 5.1 è©•ä¾¡åŸºæº–ï¼ˆ9é …ç›®ï¼‰

Ver3.57ã§ã¯ã€ä»¥ä¸‹ã®9é …ç›®ã§è©•ä¾¡ã•ã‚Œã‚‹ã€‚å„é …ç›®ã¯0ç‚¹ãƒ»1ç‚¹ãƒ»2ç‚¹ã®3æ®µéšè©•ä¾¡ã€‚

#### é …ç›®1: å°å…¥ï¼ˆåä¹—ã‚Š/æŒ¨æ‹¶ï¼‰

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | æ°åã‚’åä¹—ã‚Šã€å½¹å‰²ã‚’ä¼ãˆã€æ‚£è€…ã®æ°åãƒ»å¹´é½¢ã‚’ç¢ºèªã—ãŸ |
| **1ç‚¹** | æŒ¨æ‹¶ã¾ãŸã¯æ°åç¢ºèªã®ã„ãšã‚Œã‹ä¸€æ–¹ã®ã¿å®Ÿæ–½ |
| **0ç‚¹** | å°å…¥ãªã—ã€ã¾ãŸã¯æŒ¨æ‹¶ãƒ»æ°åç¢ºèªã¨ã‚‚ã«æœªå®Ÿæ–½ |

**è©•ä¾¡ä¾‹**:
- âœ… 2ç‚¹: "ã¯ã˜ã‚ã¾ã—ã¦ã€çœ‹è­·å¸«ã®ç”°ä¸­ã§ã™ã€‚ãŠåå‰ã‚’ãŠèãã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
- âš ï¸ 1ç‚¹: "ã“ã‚“ã«ã¡ã¯ã€‚ã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ"ï¼ˆåä¹—ã‚Šãªã—ï¼‰
- âŒ 0ç‚¹: ã„ããªã‚Š"ã„ã¤ã‹ã‚‰ç—›ã„ã§ã™ã‹ï¼Ÿ"

#### é …ç›®2: ä¸»è¨´

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | ã€Œä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹ã€ç­‰ã®é–‹æ”¾è³ªå•ã§ä¸»è¨´ã‚’è´å–ã—ã€å†…å®¹ã‚’å¾©å”±ã¾ãŸã¯ç¢ºèªã—ãŸ |
| **1ç‚¹** | ä¸»è¨´ã‚’è´å–ã—ãŸãŒã€ç¢ºèªãƒ»å¾©å”±ãªã—ã€ã¾ãŸã¯é–‰é–è³ªå•ã®ã¿ |
| **0ç‚¹** | ä¸»è¨´ã®è´å–ãªã— |

**é–‹æ”¾è³ªå•ã®ä¾‹**:
- âœ… "ä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ"
- âœ… "ã©ã®ã‚ˆã†ãªç—‡çŠ¶ã§ãŠå›°ã‚Šã§ã™ã‹ï¼Ÿ"
- âŒ "èƒ¸ãŒç—›ã„ã‚“ã§ã™ã‹ï¼Ÿ"ï¼ˆé–‰é–è³ªå•ï¼‰

#### é …ç›®3: OLDCART

OLDCARTæ³•ã«ã‚ˆã‚‹ç—‡çŠ¶ã®è©³ç´°è´å–ï¼š

| ç•¥èª | æ„å‘³ | è³ªå•ä¾‹ |
|------|------|--------|
| **O** | Onsetï¼ˆç™ºç—‡æ™‚æœŸï¼‰ | "ã„ã¤ã‹ã‚‰ç—‡çŠ¶ãŒå§‹ã¾ã‚Šã¾ã—ãŸã‹ï¼Ÿ" |
| **P** | Provocation/Palliationï¼ˆå¢—æ‚ªãƒ»å¯›è§£å› å­ï¼‰ | "ä½•ã‚’ã™ã‚‹ã¨ç—›ã¿ãŒå¼·ããªã‚Šã¾ã™ã‹ï¼Ÿ" |
| **Q** | Qualityï¼ˆæ€§çŠ¶ï¼‰ | "ã©ã‚“ãªç—›ã¿ã§ã™ã‹ï¼Ÿã‚ºã‚­ã‚ºã‚­ï¼Ÿç· ã‚ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼Ÿ" |
| **R** | Region/Radiationï¼ˆéƒ¨ä½ãƒ»æ”¾æ•£ï¼‰ | "ç—›ã¿ã¯ã©ã“ã§ã™ã‹ï¼Ÿä»–ã«åºƒãŒã‚Šã¾ã™ã‹ï¼Ÿ" |
| **S** | Severityï¼ˆç¨‹åº¦ï¼‰ | "ç—›ã¿ã®å¼·ã•ã¯10æ®µéšã§ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ" |
| **T** | Timeï¼ˆæ™‚é–“çµŒéï¼‰ | "ãšã£ã¨ç—›ã„ã§ã™ã‹ï¼Ÿæ³¢ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ" |

**è©•ä¾¡åŸºæº–**:

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | OLDCART ã®ã†ã¡ **5é …ç›®ä»¥ä¸Š** ã‚’è´å– |
| **1ç‚¹** | OLDCART ã®ã†ã¡ **2ã€œ4é …ç›®** ã‚’è´å– |
| **0ç‚¹** | OLDCARTé …ç›®ã®è´å–ãŒ **1é …ç›®ä»¥ä¸‹** |

#### é …ç›®4: ROS & Red Flag

**ROS (Review of Systems)**: éšä¼´ç—‡çŠ¶ã®ç³»çµ±çš„ç¢ºèª  
**Red Flag**: é‡ç¯¤ãªç–¾æ‚£ã®å±é™ºä¿¡å·

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | éšä¼´ç—‡çŠ¶ã‚’è¤‡æ•°è´å–ã—ã€é‡ç¯¤ãªç–¾æ‚£ã®å±é™ºä¿¡å·ã‚’ç¢ºèª |
| **1ç‚¹** | éšä¼´ç—‡çŠ¶ã®è´å–ã¯ã‚ã‚‹ãŒã€Red Flagã®ç¢ºèªãŒä¸ååˆ† |
| **0ç‚¹** | éšä¼´ç—‡çŠ¶ãƒ»Red Flagã¨ã‚‚ã«æœªç¢ºèª |

**Red Flagã®ä¾‹**:
- å‘¼å¸å›°é›£
- æ„è­˜éšœå®³
- èƒ¸ç—›ã®æ”¾æ•£ï¼ˆè‚©ãƒ»é¡ãƒ»èƒŒä¸­ï¼‰
- å†·æ±—
- å¤±ç¥
- è¡€ä¾¿ãƒ»è¡€å°¿

**éšä¼´ç—‡çŠ¶ã®ä¾‹**:
- "åãæ°—ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
- "ç†±ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
- "æ¯è‹¦ã—ã•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"

#### é …ç›®5: åŒ»ç™‚ãƒ»ç”Ÿæ´»æ­´

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | æ—¢å¾€æ­´ãƒ»å†…æœè–¬ãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ­´ãƒ»å–«ç…™/é£²é…’æ­´ã®ã†ã¡ **3é …ç›®ä»¥ä¸Š** ã‚’è´å– |
| **1ç‚¹** | ä¸Šè¨˜ã®ã†ã¡ **1ã€œ2é …ç›®** ã‚’è´å– |
| **0ç‚¹** | åŒ»ç™‚æ­´ãƒ»ç”Ÿæ´»æ­´ã®è´å–ãªã— |

**è³ªå•ä¾‹**:
- "ã“ã‚Œã¾ã§ã«å¤§ããªç—…æ°—ã‚’ã•ã‚ŒãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
- "ä»Šã€é£²ã‚“ã§ã„ã‚‹ãŠè–¬ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
- "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
- "ã‚¿ãƒã‚³ã¯å¸ã‚ã‚Œã¾ã™ã‹ï¼Ÿ"
- "ãŠé…’ã¯é£²ã¾ã‚Œã¾ã™ã‹ï¼Ÿ"

#### é …ç›®6: å—è¨ºå¥‘æ©Ÿ

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | ã€Œãªãœä»Šæ—¥å—è¨ºã•ã‚ŒãŸã®ã§ã™ã‹ã€ç­‰ã§å—è¨ºç†ç”±ãƒ»ãã£ã‹ã‘ã‚’æ˜ç¢ºã«è´å– |
| **1ç‚¹** | å—è¨ºå¥‘æ©Ÿã«è§¦ã‚ŒãŸãŒã€è©³ç´°ãªç¢ºèªãªã— |
| **0ç‚¹** | å—è¨ºå¥‘æ©Ÿã®è´å–ãªã— |

**è³ªå•ä¾‹**:
- "ãªãœä»Šæ—¥ã€ç—…é™¢ã«æ¥ã‚‰ã‚ŒãŸã®ã§ã™ã‹ï¼Ÿ"
- "ã©ã†ã—ã¦ä»Šæ—¥å—è¨ºã—ã‚ˆã†ã¨æ€ã‚ã‚ŒãŸã®ã§ã™ã‹ï¼Ÿ"
- "ã„ã¤ã‚‚ã¨é•ã†ã¨æ„Ÿã˜ãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"

#### é …ç›®7: ãƒã‚¤ã‚¿ãƒ«/ç¾ç—‡

**ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•åˆ¤å®š**ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼‰

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã‚’å®Ÿæ–½ã—ãŸï¼ˆä½“æ¸©ãƒ»è¡€åœ§ãƒ»è„ˆæ‹ç­‰ï¼‰ |
| **0ç‚¹** | ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã‚’å®Ÿæ–½ã—ãªã‹ã£ãŸ |

**åˆ¤å®šæ–¹æ³•**: `checkForVitalKeywords()` é–¢æ•°ã«ã‚ˆã‚‹éŸ³å£°èªè­˜

**æ¤œå‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**:
```javascript
const vitalKeywords = {
  temperature: ['ä½“æ¸©', 'ç†±', 'æ¸©åº¦', 'ä½“æ¸©æ¸¬', 'temperature'],
  bloodPressure: ['è¡€åœ§', 'ã‘ã¤ã‚ã¤', 'è¡€åœ§æ¸¬', 'blood pressure'],
  pulse: ['è„ˆæ‹', 'è„ˆ', 'å¿ƒæ‹', 'pulse', 'heart rate'],
  respiration: ['å‘¼å¸', 'å‘¼å¸æ•°', 'respiration'],
  spo2: ['é…¸ç´ ', 'spo2', 'saturation', 'é…¸ç´ é£½å’Œåº¦']
};
```

**å®Ÿè£…** (practice.js Line 3606-3663):
```javascript
function checkForVitalKeywords(text) {
  const matchedItems = [];
  const lowerText = text.toLowerCase();
  
  for (const [itemName, keywords] of Object.entries(vitalKeywords)) {
    const found = keywords.some(kw => lowerText.includes(kw.toLowerCase()));
    if (found) {
      matchedItems.push(itemName);
    }
  }
  
  return matchedItems;  // e.g., ["temperature", "bloodPressure"]
}
```

**æ¸¬å®šå€¤ã®è¡¨ç¤º**: çœ‹è­·å¸«ãŒæ¸¬å®šã‚’å®£è¨€ã™ã‚‹ã¨ã€æ‚£è€…ã®è¨­å®šå€¤ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚

#### é …ç›®8: èº«ä½“è¨ºå¯Ÿ

**ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•åˆ¤å®š**ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼‰

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | èº«ä½“è¨ºå¯Ÿã‚’å®Ÿæ–½ã—ãŸï¼ˆè¦–è¨ºãƒ»è§¦è¨ºãƒ»è´è¨ºãƒ»æ‰“è¨ºï¼‰ |
| **0ç‚¹** | èº«ä½“è¨ºå¯Ÿã‚’å®Ÿæ–½ã—ãªã‹ã£ãŸ |

**æ¤œå‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**:
```javascript
const examKeywords = {
  inspection: ['è¦–è¨º', 'è¦‹ã¾ã™', 'è¦‹ã¦', 'è¦‹ã›ã¦', 'è¦³å¯Ÿ'],
  palpation: ['è§¦è¨º', 'è§¦ã‚Šã¾ã™', 'è§¦ã£ã¦', 'æŠ¼ã—ã¦', 'ãŠè…¹'],
  auscultation: ['è´è¨º', 'è´ãã¾ã™', 'è´ã„ã¦', 'å¿ƒéŸ³', 'å‘¼å¸éŸ³'],
  percussion: ['æ‰“è¨º', 'æ‰“ã¡ã¾ã™', 'å©ã„ã¦', 'å©ã']
};
```

#### é …ç›®9: é€²è¡Œ

| ã‚¹ã‚³ã‚¢ | åŸºæº– |
|--------|------|
| **2ç‚¹** | è«–ç†çš„ãªé †åºã§æƒ…å ±åé›†ã—ã€æ‚£è€…ã®è¨´ãˆã«å¿œã˜ã¦æŸ”è»Ÿã«è³ªå•ã‚’å±•é–‹ |
| **1ç‚¹** | æƒ…å ±åé›†ã®é †åºã«ä¸€éƒ¨ä¸è‡ªç„¶ã•ãŒã‚ã‚‹ã€ã¾ãŸã¯ç¡¬ç›´çš„ãªè³ªå• |
| **0ç‚¹** | æƒ…å ±åé›†ã®æµã‚ŒãŒä¸é©åˆ‡ã€ã¾ãŸã¯æ¥µç«¯ã«çŸ­æ™‚é–“ã§çµ‚äº† |

**è©•ä¾¡è¦³ç‚¹**:
- å°å…¥â†’ä¸»è¨´â†’è©³ç´°â†’æ—¢å¾€æ­´â†’è¨ºå¯Ÿã®è«–ç†çš„æµã‚Œ
- æ‚£è€…ã®å›ç­”ã‚’å—ã‘ãŸé©åˆ‡ãªè¿½åŠ è³ªå•
- å”çªãªè³ªå•ã‚„è©±é¡Œã®é£›èºãŒãªã„ã‹
- ä¼šè©±æ™‚é–“ãŒé©åˆ‡ã‹ï¼ˆç›®å®‰ï¼š2-3åˆ†ï¼‰

### 5.2 ã‚¹ã‚³ã‚¢è¨ˆç®—

#### ç·åˆã‚¹ã‚³ã‚¢ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰

```javascript
// å„é …ç›®ã®ã‚¹ã‚³ã‚¢åˆè¨ˆï¼ˆæœ€å¤§18ç‚¹ï¼‰
const totalRubricScore = rubric.reduce((sum, item) => sum + item.score, 0);

// 100ç‚¹æº€ç‚¹ã«å¤‰æ›
const score100 = Math.round((totalRubricScore / 18) * 100);
```

**ä¾‹**:
- å…¨é …ç›®2ç‚¹æº€ç‚¹: 18ç‚¹ â†’ 100ç‚¹
- å„é …ç›®å¹³å‡1.5ç‚¹: 13.5ç‚¹ â†’ 75ç‚¹
- å„é …ç›®å¹³å‡1ç‚¹: 9ç‚¹ â†’ 50ç‚¹
- å„é …ç›®å¹³å‡0.5ç‚¹: 4.5ç‚¹ â†’ 25ç‚¹

#### è©•ä¾¡åŸºæº–ã®ç›®å®‰

| ã‚¹ã‚³ã‚¢ç¯„å›² | è©•ä¾¡ | æ„å‘³ |
|-----------|------|------|
| **90-100ç‚¹** | å„ªç§€ | å…¨é …ç›®ã‚’ã»ã¼å®Œç’§ã«å®Ÿæ–½ |
| **75-89ç‚¹** | è‰¯å¥½ | ä¸»è¦é …ç›®ã‚’é©åˆ‡ã«å®Ÿæ–½ã€ä¸€éƒ¨æ”¹å–„ã®ä½™åœ° |
| **60-74ç‚¹** | åˆæ ¼ | åŸºæœ¬çš„ãªå•è¨ºã¯å®Ÿæ–½ã€è¤‡æ•°ã®æ”¹å–„ç‚¹ã‚ã‚Š |
| **50-59ç‚¹** | è¦æ”¹å–„ | é‡è¦é …ç›®ã«æŠœã‘ã‚ã‚Šã€ç·´ç¿’ãŒå¿…è¦ |
| **0-49ç‚¹** | ä¸ååˆ† | åŸºæœ¬çš„ãªå•è¨ºæ‰‹é †ã®ç†è§£ãŒä¸è¶³ |

### 5.3 ç·è©•ï¼ˆSummaryï¼‰ç”Ÿæˆãƒ«ãƒ¼ãƒ«

AIãŒç”Ÿæˆã™ã‚‹ç·è©•ã¯ã€ä»¥ä¸‹ã®å³æ ¼ãªãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼š

```javascript
// server.js Line 477-524
const system = `
ã‚ãªãŸã¯çœ‹è­·æ•™è‚²ã®è©•ä¾¡è€…ã§ã™ã€‚å­¦ç”Ÿã®å•è¨ºå¯¾è©±ã‚’è©•ä¾¡ã—ã€JSONå½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

summaryï¼ˆç·è©•ï¼‰ã®ä½œæˆãƒ«ãƒ¼ãƒ«ï¼ˆå³å®ˆï¼‰:
- æ—¥æœ¬èªã®ã€Œã§ã™ãƒ»ã¾ã™èª¿ã€
- 2ã€œ3æ–‡ã€åˆè¨ˆ180ã€œ250æ–‡å­—ã«åã‚ã‚‹
- ä¼šè©±ãƒ­ã‚°ã®äº‹å®Ÿã«åŸºã¥ãå…·ä½“çš„ãªè¦³å¯Ÿã‚’å°‘ãªãã¨ã‚‚3ç‚¹å«ã‚ã‚‹
  ä¾‹: "æ°åç¢ºèªãªã—" "OLDCARTã®'å¢—æ‚ª/å¯›è§£'æœªç¢ºèª" "èƒ¸ç—›ã®éšä¼´ç—‡çŠ¶ã‚’æœªè³ªå•"
- ã‚ã„ã¾ã„èªã®ç¦æ­¢
  ä¾‹: âŒ "å…¨ä½“çš„ã«" "ã ã„ãŸã„" "ä¸ååˆ†" "ã‚‚ã£ã¨" "æ°—ã‚’ã¤ã‘ãŸã„"
- å…·ä½“çš„ãªåè©ãƒ»å‹•è©ã§è¨˜è¿°ã™ã‚‹
- æ–°ã—ã„äº‹å®Ÿã®å‰µä½œã¯ç¦æ­¢
- å¿…è¦ã«å¿œã˜ã¦çœ‹è­·å¸«/æ‚£è€…ã®ç™ºè¨€ã‚’çŸ­ãã€Œã€ã§å¼•ç”¨ã—ã¦ã‚ˆã„
- æ‰¹åˆ¤ã¯ç°¡æ½”ã«ã—ã€æœ€å¾Œã¯æ¬¡å›ã«å‘ã‘ãŸåŠ±ã¾ã—ã®1æ–‡ã§ç· ã‚ã‚‹

positivesï¼ˆè‰¯ã‹ã£ãŸç‚¹ï¼‰:
- å…·ä½“çš„ãªè¡Œå‹•ã‚’3ã¤æŒ™ã’ã‚‹
- å„20ã€œ40æ–‡å­—
- äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã§è¨˜è¿°

improvementsï¼ˆæ”¹å–„ç‚¹ï¼‰:
- å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’3ã¤æŒ™ã’ã‚‹
- å„20ã€œ40æ–‡å­—
- "ã€œã‚’ç¢ºèªã™ã‚‹" "ã€œã‚’è´å–ã™ã‚‹" ãªã©å‹•è©ã§çµ‚ã‚ã‚‹
`;
```

**è‰¯ã„ç·è©•ã®ä¾‹**:
```
æ°åã¨å¹´é½¢ã®ç¢ºèªã‚’ä¸å¯§ã«å®Ÿæ–½ã—ã€ã€Œä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹ã€ã¨é–‹æ”¾è³ªå•ã§ä¸»è¨´ã‚’è´å–ã§ãã¾ã—ãŸã€‚
ãŸã ã—ã€OLDCARTã§ã¯ã€Œå¢—æ‚ªãƒ»å¯›è§£å› å­ã€ã®ç¢ºèªãŒæŠœã‘ã¦ãŠã‚Šã€éšä¼´ç—‡çŠ¶ã¨ã—ã¦é‡è¦ãªã€Œå‘¼å¸å›°é›£ã€ã®
ç¢ºèªã‚‚è¡Œã‚ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã¨è´è¨ºã‚’å®Ÿæ–½ã—ãŸç‚¹ã¯è©•ä¾¡ã§ãã¾ã™ã€‚æ¬¡å›ã¯ç—‡çŠ¶ã®
è©³ç´°ã‚’ä½“ç³»çš„ã«ç¢ºèªã™ã‚‹ã“ã¨ã‚’æ„è­˜ã—ã¦å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ã€‚
```

**æ‚ªã„ç·è©•ã®ä¾‹ï¼ˆNGï¼‰**:
```
âŒ å…¨ä½“çš„ã«è‰¯ã‹ã£ãŸã§ã™ãŒã€ã‚‚ã†å°‘ã—è©³ã—ãèã‘ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
   æ¬¡å›ã¯é ‘å¼µã£ã¦ãã ã•ã„ã€‚
```
ç†ç”±: ã‚ã„ã¾ã„èªã ã‚‰ã‘ã§å…·ä½“æ€§ãŒãªã„

### 5.4 è©•ä¾¡APIå®Ÿè£…

```javascript
// server.js Line 433-574
// å¯¾è©±çµ‚äº†æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
if (OPENAI_API_KEY && messages.length) {
  // 1. ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯è©•ä¾¡ã‚’GPT-4o-miniã«ä¾é ¼
  const rubricJson = await openaiChatJSON({
    system: evaluationSystemPrompt,
    user: conversationLog,
    model: "gpt-4o-mini"
  });
  
  // 2. ãƒã‚¤ã‚¿ãƒ«/è¨ºå¯Ÿã®åˆ¤å®šçµæœã‚’ä¸Šæ›¸ã
  rubric[6].score = vitalChecked ? 2 : 0;
  rubric[6].comment = vitalChecked 
    ? 'ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã‚’å®Ÿæ–½ã—ã¾ã—ãŸ'
    : 'ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã›ã‚“';
    
  rubric[7].score = examChecked ? 2 : 0;
  rubric[7].comment = examChecked
    ? 'èº«ä½“è¨ºå¯Ÿã‚’å®Ÿæ–½ã—ã¾ã—ãŸ'
    : 'èº«ä½“è¨ºå¯Ÿã‚’å®Ÿæ–½ã—ã¾ã›ã‚“ã§ã—ãŸ';
  
  // 3. ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
  const totalScore = rubric.reduce((sum, item) => sum + item.score, 0);
  const score100 = Math.round((totalScore / 18) * 100);
  
  // 4. Firestoreã«ä¿å­˜
  await db.collection("sessions").doc(sessionId).update({
    analysis: {
      report: {
        rubric: rubric,
        summary: rubricJson.summary,
        positives: rubricJson.positives,
        improvements: rubricJson.improvements
      },
      score100: score100,
      analyzedAt: admin.firestore.FieldValue.serverTimestamp()
    },
    hasAnalysis: true,
    hasScore: true
  });
}
```

---

## 6. ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ãƒ»èº«ä½“è¨ºå¯Ÿåˆ¤å®š

### 6.1 åˆ¤å®šã®ä»•çµ„ã¿

ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®šã¨èº«ä½“è¨ºå¯Ÿã®å®Ÿæ–½åˆ¤å®šã¯ã€**éŸ³å£°èªè­˜ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°**ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«è¡Œã‚ã‚Œã‚‹ã€‚

### 6.2 ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³åˆ¤å®š

#### æ¤œå‡ºãƒ•ãƒ­ãƒ¼

```
1. çœ‹è­·å¸«ã®ç™ºè¨€: "ä½“æ¸©ã‚’æ¸¬ã‚‰ã›ã¦ãã ã•ã„"
   â†“
2. éŸ³å£°èªè­˜ (OpenAI Realtime API + Web Speech API)
   â†“
3. ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›: "ä½“æ¸©ã‚’æ¸¬ã‚‰ã›ã¦ãã ã•ã„"
   â†“
4. checkForVitalKeywords() å®Ÿè¡Œ
   â†“
5. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒ: "ä½“æ¸©" â†’ temperature
   â†“
6. ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º: ãƒã‚¤ã‚¿ãƒ«å…¥åŠ›ç”»é¢
   â†“
7. çœ‹è­·å¸«ãŒå€¤ã‚’ç¢ºèª/å…¥åŠ›
   â†“
8. vitalChecked = true ã«ãƒãƒ¼ã‚¯
   â†“
9. è©•ä¾¡æ™‚ã«ã‚¹ã‚³ã‚¢ã«åæ˜ ï¼ˆ2ç‚¹ï¼‰
```

#### å®Ÿè£…è©³ç´°

```javascript
// practice.js Line 3606-3663
function checkForVitalKeywords(text) {
  const matchedItems = [];
  const lowerText = text.toLowerCase();
  
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å®šç¾©
  const defaultVitalKeywords = {
    temperature: [
      'ä½“æ¸©', 'ç†±', 'æ¸©åº¦', 'ä½“æ¸©æ¸¬', 'ç†±æ¸¬',
      'temperature', 'temp', 'fever',
      'æ¸¬ã‚Šã¾ã™', 'æ¸¬ã£ã¦', 'æ¸¬ã‚Š', 'ã¯ã‹ã‚Š'
    ],
    bloodPressure: [
      'è¡€åœ§', 'ã‘ã¤ã‚ã¤', 'è¡€åœ§æ¸¬',
      'blood pressure', 'bp', 'pressure'
    ],
    pulse: [
      'è„ˆæ‹', 'è„ˆ', 'å¿ƒæ‹', 'è„ˆæ¸¬',
      'pulse', 'heart rate', 'hr'
    ],
    respiration: [
      'å‘¼å¸', 'å‘¼å¸æ•°',
      'respiration', 'breathing', 'respiratory rate'
    ],
    spo2: [
      'é…¸ç´ ', 'spo2', 'sp02', 'oxygen',
      'saturation', 'ã‚µãƒãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'é…¸ç´ é£½å’Œåº¦'
    ]
  };
  
  // ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¤ã‚¿ãƒ«é …ç›®ã‚‚è¿½åŠ 
  if (currentVitalData) {
    for (const [key, vitalData] of Object.entries(currentVitalData)) {
      if (vitalData.custom && vitalData.label) {
        vitalKeywords[key] = [vitalData.label];
      }
    }
  }
  
  // ãƒãƒƒãƒãƒ³ã‚°å‡¦ç†
  for (const [itemName, keywords] of Object.entries(vitalKeywords)) {
    const found = keywords.some(kw => 
      lowerText.includes(kw.toLowerCase())
    );
    if (found) {
      matchedItems.push(itemName);
    }
  }
  
  return matchedItems;
}
```

#### ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºæ™‚ã€ä»¥ä¸‹ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³æ¸¬å®š                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä½“æ¸©: 37.8 â„ƒ  [ç•°å¸¸]                â”‚
â”‚  è¡€åœ§: 140/90 mmHg  [ç•°å¸¸]           â”‚
â”‚  è„ˆæ‹: 95 å›/åˆ†  [ç•°å¸¸]               â”‚
â”‚  SpO2: 98 %  [æ­£å¸¸]                  â”‚
â”‚                                     â”‚
â”‚  [ç¢ºèª] [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¡¨ç¤ºå€¤**: æ‚£è€…ãƒ‡ãƒ¼ã‚¿ã® `expectedVitals` ã¾ãŸã¯ `customVitals` ã‹ã‚‰å–å¾—

**ç¢ºèªãƒœã‚¿ãƒ³**: æŠ¼ã™ã¨ `vitalChecked = true` ã«ãªã‚Šã€è©•ä¾¡ã§2ç‚¹ç²å¾—

### 6.3 èº«ä½“è¨ºå¯Ÿåˆ¤å®š

#### æ¤œå‡ºãƒ•ãƒ­ãƒ¼

ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã¨åŒæ§˜ã®ãƒ•ãƒ­ãƒ¼ã§ã€èº«ä½“è¨ºå¯Ÿã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡ºã€‚

#### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å®šç¾©

```javascript
// practice.js Line 3666-3708
const examKeywords = {
  inspection: [
    'è¦–è¨º', 'è¦‹ã¾ã™', 'è¦‹ã¦', 'è¦‹ã›ã¦', 'è¦³å¯Ÿ', 'ç¢ºèª',
    'inspection', 'look', 'observe', 'visual'
  ],
  palpation: [
    'è§¦è¨º', 'è§¦ã‚Šã¾ã™', 'è§¦ã£ã¦', 'è§¦ã‚Œ', 'æŠ¼ã—ã¦', 'æŠ¼ã—ã¾ã™',
    'palpation', 'touch', 'feel', 'press', 'è…¹éƒ¨', 'ãŠè…¹'
  ],
  auscultation: [
    'è´è¨º', 'è´ãã¾ã™', 'è´ã„ã¦', 'è´ã‹ã›', 'éŸ³', 'èã',
    'auscultation', 'listen', 'sounds', 'å¿ƒéŸ³', 'å‘¼å¸éŸ³',
    'è‚ºã®éŸ³', 'èƒ¸ã®éŸ³'
  ],
  percussion: [
    'æ‰“è¨º', 'æ‰“ã¡ã¾ã™', 'å©ã„ã¦', 'å©ã',
    'percussion', 'tap', 'percuss'
  ]
};
```

#### è¨ºå¯Ÿé …ç›®ã®è¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èº«ä½“è¨ºå¯Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜‘ è¦–è¨º (Inspection)                â”‚
â”‚  â˜‘ è§¦è¨º (Palpation)                 â”‚
â”‚  â˜‘ è´è¨º (Auscultation)              â”‚
â”‚  â˜ æ‰“è¨º (Percussion)                â”‚
â”‚                                     â”‚
â”‚  æ‰€è¦‹: è…¹éƒ¨ã«åœ§ç—›ã‚ã‚Š                 â”‚
â”‚                                     â”‚
â”‚  [ç¢ºèª] [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 åˆ¤å®šç²¾åº¦ã®å‘ä¸Š

#### äºŒé‡éŸ³å£°èªè­˜

ç²¾åº¦å‘ä¸Šã®ãŸã‚ã€2ã¤ã®éŸ³å£°èªè­˜ã‚’ä¸¦è¡Œä½¿ç”¨ï¼š

1. **OpenAI Realtime API** (ãƒ¡ã‚¤ãƒ³)
   - WebRTCçµŒç”±ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èªè­˜
   - ç²¾åº¦ãŒé«˜ã„
   - å¯¾è©±ã®æ–‡è„ˆã‚’ç†è§£

2. **Web Speech API** (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
   - ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ–API
   - ä½é…å»¶
   - OpenAIèªè­˜å¤±æ•—æ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```javascript
// practice.js Line 1551-1591
if ('webkitSpeechRecognition' in window) {
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = 'ja-JP';
  
  recognition.onresult = (event) => {
    for (let i = event.resultIndex; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        const transcript = event.results[i][0].transcript;
        
        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        const vitalItems = checkForVitalKeywords(transcript);
        if (vitalItems.length > 0) {
          showVitalModal(vitalItems);
        }
        
        const examItems = checkForExamKeywords(transcript);
        if (examItems.length > 0) {
          showExamModal(examItems);
        }
      }
    }
  };
  
  recognition.start();
}
```

#### ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ 

ç®¡ç†è€…ã¯æ‚£è€…ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ å¯èƒ½ï¼ˆå°†æ¥æ‹¡å¼µï¼‰ï¼š

```javascript
// æ‚£è€…ãƒ‡ãƒ¼ã‚¿ã«ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ 
{
  customVitals: {
    bloodSugar: {
      label: "è¡€ç³–å€¤",
      value: "180",
      unit: "mg/dL",
      keywords: ["è¡€ç³–", "ç³–", "blood sugar", "glucose"]
    }
  }
}
```

---

## 7. AIã‚³ãƒ¼ãƒæ©Ÿèƒ½

### 7.1 æ¦‚è¦

å­¦ç”Ÿã®å­¦ç¿’å±¥æ­´ã‚’åˆ†æã—ã€å€‹åˆ¥åŒ–ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨æ”¹å–„ææ¡ˆã‚’æä¾›ã™ã‚‹AIæ©Ÿèƒ½ã€‚

### 7.2 æ©Ÿèƒ½ç¨®é¡

| æ©Ÿèƒ½ | å¯¾è±¡ | èª¬æ˜ |
|------|------|------|
| **ç®¡ç†è€…ç”¨AIåˆ†æ** | æ•™å“¡ | ã‚¯ãƒ©ã‚¹å…¨ä½“ã®å‚¾å‘åˆ†æ |
| **å­¦ç”Ÿç”¨AIã‚³ãƒ¼ãƒ** | å­¦ç”Ÿ | å€‹äººã®æˆé•·åˆ†æã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ |
| **ç·´ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹** | å­¦ç”Ÿ | ãƒ›ãƒ¼ãƒ ç”»é¢ã§ã®æ”¹å–„ç‚¹æç¤º |

### 7.3 å­¦ç”Ÿç”¨AIã‚³ãƒ¼ãƒ

#### ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

```
ãƒ›ãƒ¼ãƒ ç”»é¢ â†’ ã€ŒAIã‚³ãƒ¼ãƒã€ã‚«ãƒ¼ãƒ‰ â†’ è³ªå•å…¥åŠ› â†’ é€ä¿¡
```

#### åˆ†æãƒ‡ãƒ¼ã‚¿

```javascript
// server.js Line 1560-1635
// å­¦ç”Ÿã®æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ï¼ˆæœ€å¤§20ä»¶ï¼‰
const sessions = await db.collection("sessions")
  .where("uid", "==", uid)
  .where("hasScore", "==", true)
  .orderBy("createdAt", "desc")
  .limit(20)
  .get();

// ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼ä½œæˆ
const dataSummary = {
  totalSessions: sessions.length,
  sessionsWithScore: sessions.filter(s => s.score100 > 0).length,
  avgScore: Math.round(avgScore * 10) / 10,
  bestScore: Math.max(...scores),
  recentSessions: sessions.slice(0, 5).map(s => ({
    date: s.createdAt.toDate().toLocaleDateString('ja-JP'),
    score: s.score100,
    duration: s.duration,
    rubricScores: s.rubric.map(r => ({
      item: r.item,
      score: r.score
    }))
  }))
};
```

#### GPT-4o-miniãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```javascript
// server.js Line 1613-1648
const systemPrompt = `
ã‚ãªãŸã¯çœ‹è­·æ•™è‚²ã®ãƒ¡ãƒ³ã‚¿ãƒ¼ã§ã™ã€‚å­¦ç”Ÿã®å¯¾è©±ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€
å€‹åˆ¥ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚

ã€ãƒ‡ãƒ¼ã‚¿ã®èª¬æ˜ã€‘
- è©•ä¾¡æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: ${dataSummary.sessionsWithScore}
- å¹³å‡ã‚¹ã‚³ã‚¢: ${dataSummary.avgScore}ç‚¹/100ç‚¹
- æœ€é«˜ã‚¹ã‚³ã‚¢: ${dataSummary.bestScore}ç‚¹/100ç‚¹

ã€ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯é …ç›®ã€‘
1. å°å…¥ï¼ˆåä¹—ã‚Š/æŒ¨æ‹¶ï¼‰
2. ä¸»è¨´ï¼ˆé–‹æ”¾è³ªå•ï¼‰
3. OLDCARTï¼ˆç—‡çŠ¶è©³ç´°ï¼‰
4. ROS & Red Flagï¼ˆéšä¼´ç—‡çŠ¶ãƒ»å±é™ºä¿¡å·ï¼‰
5. åŒ»ç™‚ãƒ»ç”Ÿæ´»æ­´
6. å—è¨ºå¥‘æ©Ÿ
7. ãƒã‚¤ã‚¿ãƒ«/ç¾ç—‡
8. èº«ä½“è¨ºå¯Ÿ
9. é€²è¡Œï¼ˆè«–ç†çš„æµã‚Œï¼‰

ã€åˆ†æã®è¦³ç‚¹ã€‘
- å¼·ã¿: ã©ã®é …ç›®ãŒå®‰å®šã—ã¦é«˜å¾—ç‚¹ã‹
- å¼±ç‚¹: ã©ã®é …ç›®ãŒä½å¾—ç‚¹ã®å‚¾å‘ã‹
- æˆé•·: ã‚¹ã‚³ã‚¢ã®æ¨ç§»ï¼ˆä¸Šæ˜‡ãƒ»åœæ»ãƒ»ä¸‹é™ï¼‰
- å…·ä½“çš„æ”¹å–„ç­–: æ¬¡å›ã®å¯¾è©±ã§ä½•ã‚’æ„è­˜ã™ã¹ãã‹

å›ç­”ã¯ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§ã€ä»¥ä¸‹ã‚’å«ã‚ã¦ãã ã•ã„ï¼š
1. ç·åˆè©•ä¾¡ï¼ˆ2-3æ–‡ï¼‰
2. å¼·ã¿ã®åˆ†æï¼ˆç®‡æ¡æ›¸ãï¼‰
3. æ”¹å–„ãŒå¿…è¦ãªé …ç›®ï¼ˆç®‡æ¡æ›¸ãï¼‰
4. å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ï¼ˆ3-5é …ç›®ï¼‰
5. åŠ±ã¾ã—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
`;

const userQuestion = `
${studentQuestion}

ä¸Šè¨˜ã®è³ªå•ã«å¯¾ã—ã¦ã€ç§ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’è¸ã¾ãˆã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚
`;
```

#### è³ªå•ä¾‹ã¨å›ç­”ä¾‹

**è³ªå•**: "ç§ã®å¯¾è©±ã®å¼·ã¿ã¨å¼±ã¿ã‚’æ•™ãˆã¦ãã ã•ã„"

**å›ç­”**:
```markdown
## ğŸ“Š ã‚ãªãŸã®å¯¾è©±ã‚¹ã‚­ãƒ«åˆ†æ

### ç·åˆè©•ä¾¡
20å›ã®å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å¹³å‡72.5ç‚¹ã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚
åŸºæœ¬çš„ãªå•è¨ºæ‰‹é †ã¯ç†è§£ã•ã‚Œã¦ã„ã¾ã™ãŒã€ç—‡çŠ¶ã®è©³ç´°è´å–ã«
æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚

### âœ… ã‚ãªãŸã®å¼·ã¿
- **å°å…¥**: åä¹—ã‚Šã¨æ‚£è€…ç¢ºèªãŒæ¯å›ç¢ºå®Ÿã«å®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™ï¼ˆå¹³å‡1.9ç‚¹ï¼‰
- **ä¸»è¨´**: é–‹æ”¾è³ªå•ã«ã‚ˆã‚‹ä¸»è¨´è´å–ãŒå®šç€ã—ã¦ã„ã¾ã™ï¼ˆå¹³å‡1.8ç‚¹ï¼‰
- **å—è¨ºå¥‘æ©Ÿ**: å—è¨ºç†ç”±ã®ç¢ºèªãŒé©åˆ‡ã§ã™ï¼ˆå¹³å‡1.7ç‚¹ï¼‰

### âš ï¸ æ”¹å–„ãŒå¿…è¦ãªé …ç›®
- **OLDCART**: å¹³å‡0.8ç‚¹ã€‚ç‰¹ã«ã€Œå¢—æ‚ªãƒ»å¯›è§£å› å­(P)ã€ã¨ã€Œæ”¾æ•£ç—›(R)ã€ã®
  è´å–ãŒä¸ååˆ†ã§ã™
- **ROS & Red Flag**: å¹³å‡1.0ç‚¹ã€‚éšä¼´ç—‡çŠ¶ã®ç¢ºèªãŒè¡¨é¢çš„ã§ã€é‡ç¯¤ãª
  ç–¾æ‚£ã®å±é™ºä¿¡å·ã®è¦‹è½ã¨ã—ãŒã‚ã‚Šã¾ã™
- **èº«ä½“è¨ºå¯Ÿ**: å¹³å‡0.6ç‚¹ã€‚è´è¨ºã®å®Ÿæ–½ç‡ãŒ30%ã¨ä½ã„ã§ã™

### ğŸ¯ å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

#### æ¬¡å›ã®å¯¾è©±ã§æ„è­˜ã™ã‚‹ã“ã¨
1. **OLDCARTå®Œé‚ã‚’ç›®æ¨™ã«**
   - ã€Œã©ã‚“ãªæ™‚ã«ç—›ã¿ãŒå¼·ããªã‚Šã¾ã™ã‹ï¼Ÿã€ï¼ˆå¢—æ‚ªå› å­ï¼‰
   - ã€Œç—›ã¿ã¯ä»–ã®å ´æ‰€ã«åºƒãŒã‚Šã¾ã™ã‹ï¼Ÿã€ï¼ˆæ”¾æ•£ç—›ï¼‰
   ã‚’å¿…ãšè³ªå•ã™ã‚‹

2. **Red Flagãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½¿ç”¨**
   èƒ¸ç—›ã®å ´åˆ: å‘¼å¸å›°é›£ã€å†·æ±—ã€å¤±ç¥ã€æ”¾æ•£ç—›
   ã‚’ç³»çµ±çš„ã«ç¢ºèªã™ã‚‹

3. **èº«ä½“è¨ºå¯Ÿã®ç¿’æ…£åŒ–**
   ä¸»è¨´ã«é–¢é€£ã™ã‚‹éƒ¨ä½ã®è´è¨ºã‚’å¿…ãšå®Ÿæ–½ã™ã‚‹

### ğŸ’ª åŠ±ã¾ã—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
åŸºæœ¬çš„ãªå•è¨ºæ‰‹é †ã¯ã—ã£ã‹ã‚Šå®šç€ã—ã¦ã„ã¾ã™ã€‚OLDCARTé …ç›®ã®
å®Œå…¨è´å–ã‚’æ„è­˜ã™ã‚‹ã ã‘ã§ã€80ç‚¹å°ã«åˆ°é”ã§ãã‚‹å®ŸåŠ›ãŒã‚ã‚Šã¾ã™ã€‚
æ¬¡å›ã¯ã€Œç—›ã¿ã®æ€§çŠ¶ã€ã¨ã€Œå¢—æ‚ªå› å­ã€ã«ç‰¹ã«æ³¨ç›®ã—ã¦é ‘å¼µã£ã¦ãã ã•ã„ï¼
```

### 7.4 ç®¡ç†è€…ç”¨AIåˆ†æ

æ•™å“¡å‘ã‘ã«ã€ã‚¯ãƒ©ã‚¹å…¨ä½“ã®å‚¾å‘ã‚’åˆ†æã€‚

**ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ—**:
- å…¨å­¦ç”Ÿã®ã‚»ãƒƒã‚·ãƒ§ãƒ³
- é›†è¨ˆæœŸé–“ã®æŒ‡å®šå¯èƒ½
- åŒ¿ååŒ–ã•ã‚ŒãŸçµ±è¨ˆæƒ…å ±

**åˆ†æå†…å®¹**:
- å¹³å‡ã‚¹ã‚³ã‚¢ã®æ¨ç§»
- é …ç›®åˆ¥ã®å¾—ç‚¹åˆ†å¸ƒ
- é »å‡ºã™ã‚‹æ”¹å–„ç‚¹
- ã‚¯ãƒ©ã‚¹å…¨ä½“ã®å‚¾å‘

### 7.5 ç·´ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ï¼‰

å­¦ç”ŸãŒãƒ­ã‚°ã‚¤ãƒ³æ™‚ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã«è‡ªå‹•è¡¨ç¤ºã•ã‚Œã‚‹ç°¡æ˜“ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€‚

#### è¡¨ç¤ºæ¡ä»¶

```javascript
// practice.js Line 3711-3800
// éå»10ä»¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰è©•ä¾¡æ¸ˆã¿ã®ã‚‚ã®ã‚’æŠ½å‡º
const evaluatedSessions = sessions.filter(s => 
  s.hasAnalysis || s.score100 != null
);

// è©•ä¾¡æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒ0ä»¶ãªã‚‰éè¡¨ç¤º
if (evaluatedSessions.length === 0) {
  adviceCard.style.display = "none";
  return;
}
```

#### ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

```javascript
// 1. å„é …ç›®ã®å¹³å‡ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
const itemScores = {};
for (const session of evaluatedSessions) {
  for (const item of session.rubric) {
    if (!itemScores[item.name]) itemScores[item.name] = [];
    itemScores[item.name].push(item.score);
  }
}

// 2. å¹³å‡1.0æœªæº€ã®é …ç›®ã‚’ã€Œå¼±ç‚¹ã€ã¨ã—ã¦æŠ½å‡º
const weakItems = [];
for (const [name, scores] of Object.entries(itemScores)) {
  const avg = scores.reduce((a, b) => a + b) / scores.length;
  if (avg < 1.0) {
    weakItems.push({ name, avg });
  }
}

// 3. ã‚¹ã‚³ã‚¢ãŒä½ã„é †ã«ã‚½ãƒ¼ãƒˆ
weakItems.sort((a, b) => a.avg - b.avg);

// 4. é »å‡ºã™ã‚‹æ”¹å–„ç‚¹ã‚’æŠ½å‡º
const improvementCounts = {};
for (const session of evaluatedSessions) {
  for (const imp of session.improvements) {
    improvementCounts[imp] = (improvementCounts[imp] || 0) + 1;
  }
}

// 5. è¡¨ç¤º
adviceContent.innerHTML = `
  <h4>ğŸ“Œ é‡ç‚¹çš„ã«ç·´ç¿’ã™ã¹ãé …ç›®</h4>
  <ul>
    ${weakItems.slice(0, 3).map(item => 
      `<li><strong>${item.name}</strong> (å¹³å‡: ${item.avg.toFixed(1)}ç‚¹)</li>`
    ).join('')}
  </ul>
  
  <h4>ğŸ’¡ ã‚ˆãæŒ‡æ‘˜ã•ã‚Œã‚‹æ”¹å–„ç‚¹</h4>
  <ul>
    ${topImprovements.slice(0, 3).map(imp => 
      `<li>${imp.text} (${imp.count}å›)</li>`
    ).join('')}
  </ul>
`;
```

#### è¡¨ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ã‚ãªãŸã®å­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Œ é‡ç‚¹çš„ã«ç·´ç¿’ã™ã¹ãé …ç›®                â”‚
â”‚ â€¢ OLDCART (å¹³å‡: 0.7ç‚¹)                   â”‚
â”‚ â€¢ ROS & Red Flag (å¹³å‡: 0.9ç‚¹)          â”‚
â”‚ â€¢ èº«ä½“è¨ºå¯Ÿ (å¹³å‡: 0.6ç‚¹)                 â”‚
â”‚                                         â”‚
â”‚ ğŸ’¡ ã‚ˆãæŒ‡æ‘˜ã•ã‚Œã‚‹æ”¹å–„ç‚¹                  â”‚
â”‚ â€¢ OLDCARTã®ã€Œå¢—æ‚ªãƒ»å¯›è§£å› å­ã€ã‚’ç¢ºèªã™ã‚‹    â”‚
â”‚   (5å›)                                 â”‚
â”‚ â€¢ éšä¼´ç—‡çŠ¶ã¨ã—ã¦å‘¼å¸å›°é›£ã‚’è³ªå•ã™ã‚‹        â”‚
â”‚   (4å›)                                 â”‚
â”‚ â€¢ è´è¨ºã‚’å®Ÿæ–½ã™ã‚‹ (4å›)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### 8.1 Firestoreãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å | ç”¨é€” | ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|---------------|------|---------------|
| `users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | uid, email, displayName, role |
| `test_patients` | ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ãƒ‡ãƒ¼ã‚¿ | patientNo, name, profile, expectedVitals |
| `sessions` | å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ² | uid, patientId, messages, analysis, score100 |
| `settings` | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | recordingEnabled, notificationSettings |
| `meta` | ãƒ¡ã‚¿æƒ…å ± | version, migrationStatus |
| `aiAnalysisHistory` | AIã‚³ãƒ¼ãƒå±¥æ­´ | uid, question, response, createdAt |
| `aiCoachUsage` | AIã‚³ãƒ¼ãƒä½¿ç”¨çµ±è¨ˆ | uid, date, count, limit |

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿è©³ç´°

```javascript
// sessions/{sessionId}
{
  id: "abc123xyz",
  uid: "user@example.com",
  patientId: "QNvmhCT6p9V7DgvVb7F4",
  patientNo: 23,
  patientName: "ä½è—¤ ç¾å’²",
  
  // å¯¾è©±å†…å®¹
  messages: [
    { who: "nurse", text: "ä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ", timestamp: 1234567890 },
    { who: "patient", text: "èƒ¸ãŒç—›ã„ã§ã™", timestamp: 1234567892 },
    // ...
  ],
  
  // ãƒã‚¤ã‚¿ãƒ«ãƒ»è¨ºå¯Ÿãƒã‚§ãƒƒã‚¯
  vitalChecked: true,
  examChecked: true,
  checkedVitals: ["temperature", "bloodPressure", "pulse"],
  checkedExams: ["inspection", "auscultation"],
  
  // è©•ä¾¡çµæœ
  analysis: {
    report: {
      rubric: [
        { item: "å°å…¥", score: 2, comment: "..." },
        { item: "ä¸»è¨´", score: 1, comment: "..." },
        // ... 9é …ç›®
      ],
      summary: "æ°åã¨å¹´é½¢ã®ç¢ºèªã‚’ä¸å¯§ã«å®Ÿæ–½ã—...",
      positives: ["é–‹æ”¾è³ªå•ã§ä¸»è¨´ã‚’è´å–", "..."],
      improvements: ["OLDCARTã®å¢—æ‚ªå› å­ã‚’ç¢ºèª", "..."]
    },
    score100: 72,
    analyzedAt: Timestamp
  },
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  createdAt: Timestamp,
  endedAt: Timestamp,
  duration: 185,  // ç§’
  hasScore: true,
  hasAnalysis: true,
  
  // éŸ³å£°éŒ²éŸ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  recordingUrl: "https://storage.googleapis.com/.../recording.webm"
}
```

### 8.2 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

#### è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆFirestoreï¼‰

Google Cloud Firestoreã¯è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œï¼š

- **Point-in-Time Recovery**: éå»7æ—¥é–“ã®ä»»æ„ã®æ™‚ç‚¹ã«å¾©å…ƒå¯èƒ½
- **è‡ªå‹•ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: è¤‡æ•°ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«è‡ªå‹•è¤‡è£½
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿è¨¼**: ACIDç‰¹æ€§ã‚’ä¿è¨¼

#### æ‰‹å‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

ç®¡ç†è€…ãŒå®šæœŸçš„ã«å®Ÿè¡Œã™ã¹ããƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š

```bash
# Firestoreå…¨ä½“ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
gcloud firestore export gs://ver6-trainer-backup/$(date +%Y%m%d)

# ç‰¹å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
gcloud firestore export \
  --collection-ids=sessions,test_patients \
  gs://ver6-trainer-backup/$(date +%Y%m%d)
```

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

ç®¡ç†ç”»é¢ã‹ã‚‰å®Ÿè¡Œå¯èƒ½ï¼š

```javascript
// admin.js (å°†æ¥å®Ÿè£…äºˆå®š)
async function exportSessionsToCSV() {
  const sessions = await fetchAllSessions();
  const csv = convertToCSV(sessions);
  downloadCSV(csv, `sessions_${Date.now()}.csv`);
}

function convertToCSV(sessions) {
  const headers = [
    'ã‚»ãƒƒã‚·ãƒ§ãƒ³ID', 'å­¦ç”ŸID', 'æ‚£è€…å', 'æ—¥æ™‚', 
    'ã‚¹ã‚³ã‚¢', 'æ™‚é–“(ç§’)', 'ãƒã‚¤ã‚¿ãƒ«å®Ÿæ–½', 'è¨ºå¯Ÿå®Ÿæ–½',
    'å°å…¥', 'ä¸»è¨´', 'OLDCART', 'ROS', 'åŒ»ç™‚æ­´', 'å—è¨ºå¥‘æ©Ÿ',
    'ãƒã‚¤ã‚¿ãƒ«', 'è¨ºå¯Ÿ', 'é€²è¡Œ'
  ];
  
  const rows = sessions.map(s => [
    s.id,
    s.uid,
    s.patientName,
    s.createdAt.toDate().toISOString(),
    s.score100,
    s.duration,
    s.vitalChecked ? 'Yes' : 'No',
    s.examChecked ? 'Yes' : 'No',
    ...s.rubric.map(r => r.score)
  ]);
  
  return [headers, ...rows]
    .map(row => row.map(escapeCSV).join(','))
    .join('\n');
}
```

### 8.3 ãƒ‡ãƒ¼ã‚¿ä¿æŒãƒãƒªã‚·ãƒ¼

| ãƒ‡ãƒ¼ã‚¿ç¨®é¡ | ä¿æŒæœŸé–“ | ç†ç”± |
|-----------|---------|------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ² | ç„¡æœŸé™ | å­¦ç¿’å±¥æ­´ã¨ã—ã¦é•·æœŸä¿å­˜ |
| éŸ³å£°éŒ²éŸ³ | 7æ—¥é–“ | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã®ãŸã‚çŸ­æœŸä¿å­˜ |
| AIã‚³ãƒ¼ãƒå±¥æ­´ | 1å¹´é–“ | çµ±è¨ˆåˆ†æç”¨ |
| ãƒ­ã‚°ï¼ˆCloud Loggingï¼‰ | 30æ—¥é–“ | ãƒ‡ãƒãƒƒã‚°ç”¨ |

### 8.4 ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

#### å­¦ç”Ÿã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

```javascript
// å°†æ¥å®Ÿè£…äºˆå®š
async function deleteMySession(sessionId) {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ‰€æœ‰è€…ç¢ºèª
  const session = await getSession(sessionId);
  if (session.uid !== currentUser.uid) {
    throw new Error("ä»–äººã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯å‰Šé™¤ã§ãã¾ã›ã‚“");
  }
  
  // éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
  if (session.recordingUrl) {
    await deleteRecording(session.recordingUrl);
  }
  
  // Firestoreã‹ã‚‰å‰Šé™¤
  await db.collection("sessions").doc(sessionId).delete();
}
```

#### ç®¡ç†è€…ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

```javascript
// admin.js (å®Ÿè£…æ¸ˆã¿)
async function deleteAdminPatient(patientId) {
  // æ‚£è€…ã‚’å‰Šé™¤
  await fetch(`/api/admin/patients/${patientId}`, {
    method: "DELETE",
    headers: { Authorization: `Bearer ${token}` }
  });
  
  // é–¢é€£ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‡¦ç†ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚å‰Šé™¤
  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ä¿æŒï¼ˆæ‚£è€…æƒ…å ±ã‚’åŒ¿ååŒ–ï¼‰
}
```

### 8.5 GDPR/å€‹äººæƒ…å ±ä¿è­·

#### å€‹äººæƒ…å ±ã®å–ã‚Šæ‰±ã„

| ãƒ‡ãƒ¼ã‚¿ | å€‹äººæƒ…å ±è©²å½“ | ä¿è­·æªç½® |
|-------|------------|---------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (Firebase Auth) | â—‹ | Firebase Authã§æš—å·åŒ–ç®¡ç† |
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | â—‹ | Firebase Authã§æš—å·åŒ–ç®¡ç† |
| å¯¾è©±å†…å®¹ | â—‹ | Firestoreã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |
| éŸ³å£°éŒ²éŸ³ | â—‹ | 7æ—¥å¾Œè‡ªå‹•å‰Šé™¤ã€ç½²åä»˜ãURL |
| è©•ä¾¡ã‚¹ã‚³ã‚¢ | â—‹ | æœ¬äººã®ã¿é–²è¦§å¯èƒ½ |

#### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

```javascript
// Firestore Security Rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯æœ¬äººã®ã¿èª­ã¿æ›¸ãå¯èƒ½
    match /sessions/{sessionId} {
      allow read: if request.auth != null && 
        resource.data.uid == request.auth.token.email;
      allow write: if request.auth != null && 
        request.resource.data.uid == request.auth.token.email;
    }
    
    // æ‚£è€…ãƒ‡ãƒ¼ã‚¿ã¯èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡ãŒèª­ã¿å–ã‚Šå¯èƒ½
    match /test_patients/{patientId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
        request.auth.token.role == 'admin';
    }
  }
}
```

---

## 9. ã‚³ã‚¹ãƒˆæ§‹é€ 

### 9.1 OpenAI API ã‚³ã‚¹ãƒˆ

#### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±ï¼ˆæœ€å¤§ã‚³ã‚¹ãƒˆï¼‰

| é …ç›® | ãƒ¢ãƒ‡ãƒ« | èª²é‡‘å˜ä½ | æ–™é‡‘ï¼ˆæ¨å®šï¼‰ |
|------|--------|---------|------------|
| **éŸ³å£°å…¥åŠ›** | gpt-4o-realtime | $0.06/åˆ† | 1ã‚»ãƒƒã‚·ãƒ§ãƒ³(3åˆ†): $0.18 |
| **éŸ³å£°å‡ºåŠ›** | gpt-4o-realtime | $0.24/åˆ† | 1ã‚»ãƒƒã‚·ãƒ§ãƒ³(3åˆ†): $0.72 |
| **åˆè¨ˆ** | - | - | **$0.90/ã‚»ãƒƒã‚·ãƒ§ãƒ³** |

**æœˆé–“ã‚³ã‚¹ãƒˆè©¦ç®—**:
- å­¦ç”Ÿæ•°: 50äºº
- 1äººã‚ãŸã‚Šç·´ç¿’å›æ•°: 10å›/æœˆ
- åˆè¨ˆã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: 500å›/æœˆ
- **æœˆé–“ã‚³ã‚¹ãƒˆ: $450 (ç´„67,500å††)**

#### è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

| é …ç›® | ãƒ¢ãƒ‡ãƒ« | æ–™é‡‘ï¼ˆæ¨å®šï¼‰ |
|------|--------|------------|
| **å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³** | gpt-4o-mini | ä¼šè©±ãƒ­ã‚°500ãƒˆãƒ¼ã‚¯ãƒ³ â†’ $0.00008 |
| **å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³** | gpt-4o-mini | è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ300ãƒˆãƒ¼ã‚¯ãƒ³ â†’ $0.00012 |
| **åˆè¨ˆ** | - | **$0.0002/ã‚»ãƒƒã‚·ãƒ§ãƒ³** |

**æœˆé–“ã‚³ã‚¹ãƒˆ**: 500ã‚»ãƒƒã‚·ãƒ§ãƒ³ Ã— $0.0002 = **$0.10 (ç´„15å††)**

#### AIã‚³ãƒ¼ãƒ

| é …ç›® | ãƒ¢ãƒ‡ãƒ« | æ–™é‡‘ï¼ˆæ¨å®šï¼‰ |
|------|--------|------------|
| **1è³ªå•ã‚ãŸã‚Š** | gpt-4o-mini | $0.0003 |
| **æœˆé–“** | - | 50äºº Ã— 5è³ªå• = 250è³ªå• â†’ **$0.075 (ç´„11å††)** |

#### æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”Ÿæˆ

| é …ç›® | ãƒ¢ãƒ‡ãƒ« | æ–™é‡‘ï¼ˆæ¨å®šï¼‰ |
|------|--------|------------|
| **1æ‚£è€…ã‚ãŸã‚Š** | gpt-4o | $0.01 |
| **æœˆé–“** | - | 10æ‚£è€…ä½œæˆ â†’ **$0.10 (ç´„15å††)** |

### 9.2 ã‚³ã‚¹ãƒˆåˆè¨ˆï¼ˆæœˆé–“ï¼‰

| é …ç›® | æœˆé–“ã‚³ã‚¹ãƒˆ | æ¯”ç‡ |
|------|-----------|------|
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©± | $450 (67,500å††) | **99.6%** |
| è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ | $0.10 (15å††) | 0.02% |
| AIã‚³ãƒ¼ãƒ | $0.075 (11å††) | 0.017% |
| æ‚£è€…ç”Ÿæˆ | $0.10 (15å††) | 0.02% |
| **åˆè¨ˆ** | **$450.275 (67,541å††)** | **100%** |

### 9.3 Google Cloud ã‚³ã‚¹ãƒˆ

| ã‚µãƒ¼ãƒ“ã‚¹ | æœˆé–“ã‚³ã‚¹ãƒˆï¼ˆæ¨å®šï¼‰ |
|---------|-------------------|
| Cloud Run | $20 (3,000å††) - å¸¸æ™‚ç¨¼åƒä¸è¦ |
| Firestore | $10 (1,500å††) - èª­ã¿æ›¸ããƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| Cloud Storage | $2 (300å††) - éŸ³å£°éŒ²éŸ³ï¼ˆ7æ—¥ä¿æŒï¼‰ |
| Cloud Build | $5 (750å††) - CI/CD |
| **åˆè¨ˆ** | **$37 (5,550å††)** |

### 9.4 ç·ã‚³ã‚¹ãƒˆ

| ã‚«ãƒ†ã‚´ãƒª | æœˆé–“ã‚³ã‚¹ãƒˆ |
|---------|-----------|
| OpenAI API | $450.275 (67,541å††) |
| Google Cloud | $37 (5,550å††) |
| **ç·è¨ˆ** | **$487.275 (73,091å††)** |

**å­¦ç”Ÿ1äººã‚ãŸã‚Š**: ç´„1,462å††/æœˆ

### 9.5 ã‚³ã‚¹ãƒˆæœ€é©åŒ–ç­–

#### åˆ¶é™æ™‚é–“çŸ­ç¸®

| è¨­å®š | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ã‚¹ãƒˆ | æœˆé–“ã‚³ã‚¹ãƒˆå‰Šæ¸› |
|------|----------------|---------------|
| ç¾è¡Œ: 3åˆ† | $0.90 | - |
| çŸ­ç¸®: 2åˆ† | $0.60 | **-33% ($150å‰Šæ¸›)** |
| çŸ­ç¸®: 1.5åˆ† | $0.45 | **-50% ($225å‰Šæ¸›)** |

#### ç·´ç¿’å›æ•°åˆ¶é™

```javascript
// 1æ—¥ã‚ãŸã‚Šã®ç·´ç¿’å›æ•°ã‚’åˆ¶é™
const DAILY_PRACTICE_LIMIT = 3;

async function checkPracticeLimit(uid) {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const count = await db.collection("sessions")
    .where("uid", "==", uid)
    .where("createdAt", ">=", today)
    .count()
    .get();
  
  if (count.data().count >= DAILY_PRACTICE_LIMIT) {
    throw new Error(`æœ¬æ—¥ã®ç·´ç¿’å›æ•°ä¸Šé™ï¼ˆ${DAILY_PRACTICE_LIMIT}å›ï¼‰ã«é”ã—ã¾ã—ãŸ`);
  }
}
```

#### AIã‚³ãƒ¼ãƒä½¿ç”¨åˆ¶é™

```javascript
// 1æ—¥ã‚ãŸã‚Šã®AIã‚³ãƒ¼ãƒè³ªå•å›æ•°ã‚’åˆ¶é™
const DAILY_AI_COACH_LIMIT = 5;

// aiCoachUsage ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ç®¡ç†
{
  uid: "user@example.com",
  date: "2024-11-16",
  count: 3,
  limit: 5
}
```

---

## 10. ã‚·ã‚¹ãƒ†ãƒ å¤‰æ›´å±¥æ­´

### Ver3.57 (2024-11-16) - å®Œæˆç‰ˆ

**é‡è¦ãªå¤‰æ›´**:
- âœ… Ver2å›ºå®šæ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œå…¨å»ƒæ­¢
- âœ… ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ã«å®Œå…¨çµ±ä¸€
- âœ… æœªä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«78å€‹ï¼ˆ137MBï¼‰ã‚’å‰Šé™¤
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„æ§‹æˆã‚’ç¢ºç«‹

**å‰Šé™¤ã—ãŸã‚·ã‚¹ãƒ†ãƒ **:
1. å›ºå®šæ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ï¼ˆpatients/001-010/ï¼‰
2. ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰å‹•ç”»ã‚·ã‚¹ãƒ†ãƒ ï¼ˆpractice/ï¼‰
3. æœªä½¿ç”¨JSãƒ•ã‚¡ã‚¤ãƒ«6å€‹
4. æœªä½¿ç”¨å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«2å€‹

**ã‚³ãƒ¼ãƒ‰å¤‰æ›´**:
```javascript
// practice.js Line 787-792 - ã‚·ãƒ³ãƒ—ãƒ«åŒ–
function videosForExam(no){ 
  console.log(`[videosForExam] Patient No.${no}: Using default videos`);
  return VIDEO_SRC_FALLBACK;
}
```

### Ver3.56 (2024-11-16)

**å¤‰æ›´å†…å®¹**:
- ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ï¼ˆNo.11ä»¥é™ï¼‰ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ 
- æ‚£è€…ç•ªå·ã«å¿œã˜ãŸå‹•ç”»é¸æŠãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„

### Ver3.55 (2024-11-16)

**å¤‰æ›´å†…å®¹**:
- å‹•ç”»è¡¨ç¤ºå•é¡Œã®ä¿®æ­£ï¼ˆflexbox layoutï¼‰
- video-wrapã«`flex: 1`ã‚’è¿½åŠ 

### Ver3.54 (2024-11-16)

**å¤‰æ›´å†…å®¹**:
- æ‚£è€…å‰Šé™¤å‡¦ç†ã‚’å¼·åŒ–ï¼ˆå‰Šé™¤å¾Œã®ç¢ºèªã¨ãƒ­ã‚°è¿½åŠ ï¼‰
- DELETE APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 

### Ver3.53 (2024-11-16)

**å¤‰æ›´å†…å®¹**:
- æ‚£è€…ä¸€è¦§å–å¾—ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 
- å‰Šé™¤æ¸ˆã¿æ‚£è€…ãŒè¡¨ç¤ºã•ã‚Œã‚‹å•é¡Œã«å¯¾å‡¦

### Ver3.52 (2024-11-16)

**å¤‰æ›´å†…å®¹**:
- AIæ‚£è€…ã®å”åŠ›çš„å¿œç­”ã‚’å¼·åŒ–
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«COOPERATION WITH MEASUREMENTSã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

**å…·ä½“ä¾‹**:
```javascript
// ä¿®æ­£å‰: "ã‚ã‹ã‚Šã¾ã›ã‚“"
// ä¿®æ­£å¾Œ: "ã¯ã„ã€ãŠé¡˜ã„ã—ã¾ã™"ï¼ˆãƒã‚¤ã‚¿ãƒ«æ¸¬å®šä¾é ¼ã¸ã®å¿œç­”ï¼‰
```

### Ver3.51 (2024-11-10)

**å¤‰æ›´å†…å®¹**:
- UIç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
- v3.50ã§ç ´æã—ãŸbottom-bar UIã‚’å¾©å…ƒ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ™‚é–“ã‚’ã‹ã‘ã¦èª¿æ•´ã—ãŸUIã‚’ä¿è­·

### Ver3.50 (2024-11-10)

**å¤‰æ›´å†…å®¹** (âŒ å¤±æ•—ã€v3.51ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯):
- å‹•ç”»è¡¨ç¤ºå•é¡Œã®ä¿®æ­£è©¦è¡Œ
- æ„å›³ã›ãšbottom-barå…¨ä½“ã‚’ç ´å£Š

### Ver3.49 (2024-11-10)

**å¤‰æ›´å†…å®¹**:
- å‹•ç”»è¡¨ç¤ºãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ 
- setVideoStateé–¢æ•°ã«è©³ç´°ãƒ­ã‚°å®Ÿè£…

---

## ä»˜éŒ²A: API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

### èªè¨¼

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
|---------|------|------|------|
| GET | `/api/roles/me` | âœ… | ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾— |

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
|---------|------|------|------|
| POST | `/session` | âœ… | Ephemeral Tokenå–å¾—ï¼ˆå¯¾è©±é–‹å§‹ï¼‰ |
| POST | `/api/sessions/start` | âœ… | ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ |
| POST | `/api/sessions/:id/message` | âœ… | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ  |
| POST | `/api/sessions/:id/vital-check` | âœ… | ãƒã‚¤ã‚¿ãƒ«ãƒã‚§ãƒƒã‚¯è¨˜éŒ² |
| POST | `/api/sessions/:id/exam-check` | âœ… | è¨ºå¯Ÿãƒã‚§ãƒƒã‚¯è¨˜éŒ² |
| POST | `/api/sessions/:id/end` | âœ… | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ãƒ»è©•ä¾¡å®Ÿè¡Œ |
| GET | `/api/sessions/:id` | âœ… | ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°å–å¾— |
| GET | `/api/my/sessions` | âœ… | è‡ªåˆ†ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾— |

### æ‚£è€…ç®¡ç†

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
|---------|------|------|------|
| GET | `/api/test-patients` | âœ… | æ‚£è€…ä¸€è¦§å–å¾—ï¼ˆå…¬é–‹æ‚£è€…ï¼‰ |
| GET | `/api/admin/patients` | âœ… ç®¡ç†è€… | æ‚£è€…ä¸€è¦§å–å¾—ï¼ˆå…¨æ‚£è€…ï¼‰ |
| POST | `/api/admin/patients` | âœ… ç®¡ç†è€… | æ‚£è€…ä½œæˆ |
| PATCH | `/api/admin/patients/:id` | âœ… ç®¡ç†è€… | æ‚£è€…æ›´æ–° |
| DELETE | `/api/admin/patients/:id` | âœ… ç®¡ç†è€… | æ‚£è€…å‰Šé™¤ |
| POST | `/api/admin/patients/generate` | âœ… ç®¡ç†è€… | AIæ‚£è€…ç”Ÿæˆ |

### AIã‚³ãƒ¼ãƒ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
|---------|------|------|------|
| POST | `/api/student/ai-analysis` | âœ… | å­¦ç”Ÿç”¨AIã‚³ãƒ¼ãƒè³ªå• |
| POST | `/api/admin/ai-analysis` | âœ… ç®¡ç†è€… | ç®¡ç†è€…ç”¨AIåˆ†æ |

### è¨­å®š

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
|---------|------|------|------|
| GET | `/api/settings` | âœ… | è¨­å®šå–å¾— |
| POST | `/api/settings` | âœ… | è¨­å®šæ›´æ–° |

---

## ä»˜éŒ²B: ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¦ä»¶

| é …ç›® | è¦ä»¶ |
|------|------|
| **ãƒ–ãƒ©ã‚¦ã‚¶** | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| **JavaScript** | ES6+ ã‚µãƒãƒ¼ãƒˆå¿…é ˆ |
| **WebRTC** | ã‚µãƒãƒ¼ãƒˆå¿…é ˆ |
| **ãƒã‚¤ã‚¯** | å¿…é ˆ |
| **ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼** | å¿…é ˆ |
| **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ** | å®‰å®šã—ãŸæ¥ç¶šï¼ˆæ¨å¥¨: 5Mbpsä»¥ä¸Šï¼‰ |

### ã‚µãƒ¼ãƒãƒ¼è¦ä»¶

| é …ç›® | ä»•æ§˜ |
|------|------|
| **Node.js** | v20.x |
| **ãƒ¡ãƒ¢ãƒª** | 2GB |
| **CPU** | 2 vCPU |
| **ãƒ‡ã‚£ã‚¹ã‚¯** | 10GBï¼ˆä¸»ã«ãƒ­ã‚°ç”¨ï¼‰ |
| **OS** | Container (Docker) |

---

## ä»˜éŒ²C: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### éŸ³å£°ãŒèã“ãˆãªã„

**ç—‡çŠ¶**: æ‚£è€…AIã®éŸ³å£°ãŒèã“ãˆãªã„

**åŸå› ã¨å¯¾ç­–**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³å£°è¨­å®šã‚’ç¢ºèª
2. ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼/ãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³ã®æ¥ç¶šç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ç¢ºèª
4. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+Shift+Rï¼‰

### ãƒã‚¤ã‚¯ãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶**: çœ‹è­·å¸«ã®éŸ³å£°ãŒèªè­˜ã•ã‚Œãªã„

**åŸå› ã¨å¯¾ç­–**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèª
2. ã‚·ã‚¹ãƒ†ãƒ ã®ãƒã‚¤ã‚¯è¨­å®šã‚’ç¢ºèª
3. ä»–ã®ã‚¢ãƒ—ãƒªãŒãƒã‚¤ã‚¯ã‚’å æœ‰ã—ã¦ã„ãªã„ã‹ç¢ºèª
4. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§"getUserMedia"ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

### å‹•ç”»ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: æ‚£è€…ã®å‹•ç”»ãŒé»’ã„ç”»é¢ã®ã¾ã¾

**åŸå› ã¨å¯¾ç­–**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
2. å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèªï¼ˆ/assets/patient_idle.mp4ï¼‰
3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ videoWidth, videoHeight ãŒ0ã§ãªã„ã‹ç¢ºèª
4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª

### ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ãŒè¨˜éŒ²ã•ã‚Œãªã„

**ç—‡çŠ¶**: ã€Œä½“æ¸©ã‚’æ¸¬ã‚Šã¾ã™ã€ã¨è¨€ã£ã¦ã‚‚ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‡ºãªã„

**åŸå› ã¨å¯¾ç­–**:
1. æ­£ç¢ºãªç™ºéŸ³ã§è©±ã™
2. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ã‚’ç¢ºèªï¼ˆã€Œä½“æ¸©ã€ã€Œç†±ã€ã€Œæ¸©åº¦ã€ãªã©ï¼‰
3. Web Speech APIã®èªè­˜çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª
4. ãƒã‚¤ã‚¯éŸ³é‡ãŒé©åˆ‡ã‹ç¢ºèª

---

## çµè«–

æœ¬ã‚·ã‚¹ãƒ†ãƒ ï¼ˆVer3.57ï¼‰ã¯ã€çœ‹è­·å­¦ç”Ÿã®å•è¨ºæŠ€è¡“ç¿’å¾—ã‚’æ”¯æ´ã™ã‚‹åŒ…æ‹¬çš„ãªAIé§†å‹•å‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å®Œå…¨ç§»è¡Œã«ã‚ˆã‚Šã€æ•™è‚²ç¾å ´ã®ãƒ‹ãƒ¼ã‚ºã«æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã€ä¿å®ˆæ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã¨ãªã‚Šã¾ã—ãŸã€‚

**ä¸»è¦ãªç‰¹å¾´**:
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±ã«ã‚ˆã‚‹è‡ªç„¶ãªç·´ç¿’ç’°å¢ƒ
- âœ… å®¢è¦³çš„ãª9é …ç›®ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯è©•ä¾¡
- âœ… è‡ªå‹•ãƒã‚¤ã‚¿ãƒ«ãƒ»è¨ºå¯Ÿåˆ¤å®š
- âœ… å€‹åˆ¥åŒ–ã•ã‚ŒãŸAIã‚³ãƒ¼ãƒãƒ³ã‚°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§æ‹¡å¼µæ€§ã®é«˜ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**ä»Šå¾Œã®å±•é–‹**:
- å¤šè¨€èªå¯¾å¿œã®æ‹¡å……
- VR/ARãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ
- ã‚ˆã‚Šè©³ç´°ãªè¨ºå¯Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ä»–è·ç¨®é€£æºã‚·ãƒŠãƒªã‚ªã®å®Ÿè£…

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°**: 2024å¹´11æœˆ16æ—¥  
**ä½œæˆè€…**: AIé–‹ç™ºãƒãƒ¼ãƒ   
**é€£çµ¡å…ˆ**: [ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«]
