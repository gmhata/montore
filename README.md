# MONTOREï¼ˆãƒ¢ãƒ³ãƒˆãƒ¬ï¼‰

å•è¨ºãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  - Version 4.00

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**MONTORE**ï¼ˆãƒ¢ãƒ³ãƒˆãƒ¬ï¼‰ã¯ã€åŒ»ç™‚å¾“äº‹è€…å‘ã‘ã®å•è¨ºã‚¹ã‚­ãƒ«è¨“ç·´ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
OpenAI Realtime APIã‚’æ´»ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±ã«ã‚ˆã‚Šã€å®Ÿè·µçš„ãªå•è¨ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: MONTORE (MONshin TRAining + mOnitoRE)
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 4.00
- **ãƒ™ãƒ¼ã‚¹**: Ver3.57ã‹ã‚‰ã®æ–°è¦ç‹¬ç«‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ğŸŒ ç’°å¢ƒæ§‹æˆ

### æœ¬ç•ªç’°å¢ƒï¼ˆProductionï¼‰
- **ãƒ–ãƒ©ãƒ³ãƒ**: `main`
- **Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `[æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID]`ï¼ˆVer3ã¨ã¯å®Œå…¨åˆ†é›¢ï¼‰
- **Cloud Run ã‚µãƒ¼ãƒ“ã‚¹**: `montore`
- **ãƒ“ãƒ«ãƒ‰è¨­å®š**: `cloudbuild-dev.yaml`
- **URL**: https://montore-xxxxx-an.a.run.app
- **ç”¨é€”**: å®Ÿéš›ã®æ•™è‚²ãƒ»è¨“ç·´ç’°å¢ƒ

âš ï¸ **é‡è¦**: Ver3ï¼ˆver6-trainer-devï¼‰ã¨ã¯å®Œå…¨ã«åˆ†é›¢ã•ã‚ŒãŸç‹¬ç«‹ç’°å¢ƒã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€èªè¨¼ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã¹ã¦ãŒåˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```
main ãƒ–ãƒ©ãƒ³ãƒ
    â†“ (ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãƒ»æ©Ÿèƒ½è¿½åŠ )
    â†“ git add .
    â†“ git commit -m "èª¬æ˜"
    â†“ git push origin main
    â†“ â†’ Cloud Build (cloudbuild-dev.yaml)
    â†“ â†’ montore (æœ¬ç•ª) ã«ãƒ‡ãƒ—ãƒ­ã‚¤
    â†“
æœ¬ç•ªç’°å¢ƒã«åæ˜ 
```

## ğŸ“‹ é–‹ç™ºæ‰‹é †

### ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãƒ»æ©Ÿèƒ½è¿½åŠ ã®æµã‚Œ

```bash
# mainãƒ–ãƒ©ãƒ³ãƒã§ä½œæ¥­
git checkout main

# æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°
git pull origin main

# ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†
# ...

# ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½ã®èª¬æ˜"
git push origin main

# â†’ è‡ªå‹•çš„ã« montore (æœ¬ç•ª) ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹
```

**æ³¨æ„**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã¯å³åº§ã«æœ¬ç•ªç’°å¢ƒã«åæ˜ ã•ã‚Œã¾ã™ã€‚

## ğŸ”§ åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š

Firebase Console ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š
- Firestore Databaseï¼ˆasia-northeast1ï¼‰
- Authenticationï¼ˆãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
- Webã‚¢ãƒ—ãƒªç™»éŒ²

### 2. Firebase è¨­å®šã®æ›´æ–°

`public/firebase-config.js` ã‚’ä½œæˆã—ã€Firebaseèªè¨¼æƒ…å ±ã‚’è¨­å®šï¼š

```javascript
window.FIREBASE_CONFIG = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.firebasestorage.app",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
```

âš ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: `firebase-config.js`ã¯`.gitignore`ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

### 3. Cloud Build ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®š

Google Cloud Console ã§ä»¥ä¸‹ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šï¼š

- **åå‰**: `deploy-production`
- **ã‚¤ãƒ™ãƒ³ãƒˆ**: ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥
- **ã‚½ãƒ¼ã‚¹**: `^main$`
- **ãƒ“ãƒ«ãƒ‰æ§‹æˆ**: `cloudbuild-dev.yaml`
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `[æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID]`
- **ç½®æ›å¤‰æ•°**: `_ASSETS_BUCKET` = `montore-recordings`ï¼ˆã¾ãŸã¯ä»»æ„ã®åå‰ï¼‰

### 4. Firebase èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¿½åŠ 

Firebase Console > Authentication > Settings

æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã«è¿½åŠ :
- `montore-xxxxx-an.a.run.app`ï¼ˆCloud Runã®URLï¼‰

### 5. Secret Managerè¨­å®š

OpenAI API Keyã‚’ Secret Manager ã«ç™»éŒ²ï¼š

```bash
gcloud secrets create OPENAI_API_KEY \
  --project=[æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] \
  --data-file=- <<< "sk-proj-YOUR_API_KEY"

# Cloud Run ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸
gcloud secrets add-iam-policy-binding OPENAI_API_KEY \
  --project=[æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] \
  --member="serviceAccount:[PROJECT_NUMBER]-compute@developer.gserviceaccount.com" \
  --role="roles/secretmanager.secretAccessor"
```

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Backend**: Node.js 20+ / Express
- **Frontend**: Vanilla JavaScript
- **Database**: Cloud Firestore
- **Auth**: Firebase Authentication
- **AI**: OpenAI GPT-4o Realtime API / GPT-4o-mini
- **Hosting**: Google Cloud Run (Container)
- **CI/CD**: Google Cloud Build
- **Storage**: Google Cloud Storage

## ğŸ“ ç’°å¢ƒå¤‰æ•°

### æœ¬ç•ªç’°å¢ƒï¼ˆVer4ç‹¬ç«‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
- `FIREBASE_PROJECT_ID`: [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID]ï¼ˆè‡ªå‹•è¨­å®š: $PROJECT_IDï¼‰
- `FIRESTORE_PROJECT_ID`: [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID]ï¼ˆè‡ªå‹•è¨­å®š: $PROJECT_IDï¼‰
- `APP_VERSION`: 4.00
- `ASSETS_BUCKET`: montore-recordingsï¼ˆCloud Buildç½®æ›å¤‰æ•°: $_ASSETS_BUCKETï¼‰
- `OPENAI_API_KEY`: Secret Manager ã‹ã‚‰å–å¾—ï¼ˆVer4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ï¼‰

## ğŸ“ ä¸»è¦æ©Ÿèƒ½

### 1. ã‚«ã‚¹ã‚¿ãƒ æ‚£è€…ã‚·ã‚¹ãƒ†ãƒ 
- æ•™å“¡ãŒè‡ªç”±ã«æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆ
- å¹´é½¢ã€ä¸»è¨´ã€æ—¢å¾€æ­´ã€ç¾ç—…æ­´ãªã©ã‚’è¨­å®š
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§AIæ‚£è€…ã®æŒ¯ã‚‹èˆã„ã‚’åˆ¶å¾¡

### 2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±
- OpenAI Realtime APIã«ã‚ˆã‚‹è‡ªç„¶ãªä¼šè©±
- WebRTCæ¥ç¶šã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°èªè­˜
- å­¦ç”Ÿã¯å®Ÿéš›ã®å•è¨ºã®ã‚ˆã†ã«è©±ã—ã‹ã‘ã‚‰ã‚Œã‚‹

### 3. 9é …ç›®ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯è©•ä¾¡
1. å°å…¥ï¼ˆåä¹—ã‚Š/æŒ¨æ‹¶ï¼‰
2. ä¸»è¨´
3. OPQRSTæ³•
4. ROS & Red Flag
5. åŒ»ç™‚ãƒ»ç”Ÿæ´»æ­´
6. å—è¨ºå¥‘æ©Ÿ
7. ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³/ç¾ç—‡ï¼ˆè‡ªå‹•åˆ¤å®šï¼‰
8. èº«ä½“è¨ºå¯Ÿï¼ˆè‡ªå‹•åˆ¤å®šï¼‰
9. é€²è¡Œ

å„é …ç›®0-1-2ç‚¹ï¼ˆ18ç‚¹æº€ç‚¹â†’100ç‚¹æ›ç®—ï¼‰

### 4. AIã‚³ãƒ¼ãƒæ©Ÿèƒ½
- GPT-4o-miniã«ã‚ˆã‚‹å…·ä½“çš„ãªæ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹
- å­¦ç”Ÿç”¨ã¨ç®¡ç†è€…ç”¨ã®è©³ç´°åˆ†æ

### 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- å…¨ä¼šè©±ãƒ­ã‚°ã®ä¿å­˜
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãæ–‡å­—èµ·ã“ã—
- è©•ä¾¡çµæœã¨ã‚¹ã‚³ã‚¢ã®è¨˜éŒ²

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **æŠ€è¡“ä»•æ§˜æ›¸**: [TECHNICAL_SPECIFICATION_v3.57.md](./TECHNICAL_SPECIFICATION_v3.57.md)
  - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
  - è©•ä¾¡åŸºæº–ã®è©³ç´°
  - ã‚³ã‚¹ãƒˆæ§‹é€ 
  - å¤‰æ›´å±¥æ­´

## ğŸ”‘ ç®¡ç†è€…æ¨©é™

ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«: `gmhata@gmail.com`

ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ `server.js` ã® `isAdminEmail()` é–¢æ•°ã§è‡ªå‹•çš„ã«ç®¡ç†è€…æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. Cloud Build ã®ãƒ­ã‚°ã‚’ç¢ºèª
   - https://console.cloud.google.com/cloud-build/builds?project=montore

2. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã®å ´åˆ
   - `--no-cache` ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

1. Firebase èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã« Cloud Run ã® URL ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. `public/auth.js` ã® firebaseConfig ãŒæ­£ã—ã„ã‹ç¢ºèª

### 500ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

1. Cloud Run ã®ãƒ­ã‚°ã‚’ç¢ºèª
2. ç’°å¢ƒå¤‰æ•°ï¼ˆç‰¹ã« FIRESTORE_PROJECT_IDï¼‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. Firestore ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€GitHub Issues ã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚

## ğŸ“– Ver3ã¨ã®é–¢ä¿‚

MONTOREã¯Ver3.57ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ**å®Œå…¨ç‹¬ç«‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**ã§ã™ã€‚

### å®Œå…¨åˆ†é›¢ã®å®Ÿç¾

| é …ç›® | Ver3 | Ver4 (MONTORE) |
|------|------|----------------|
| **Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** | ver6-trainer-dev | [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] |
| **Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | ver6-trainer-dev | [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] |
| **Firebase Authentication** | ver6-trainer-dev | [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] |
| **GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** | ver6-trainer-dev | [æ–°è¦Ver4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID] |
| **Cloud Run ã‚µãƒ¼ãƒ“ã‚¹** | ver6-trainer | montore |
| **Cloud Storage** | ver6-trainer-recordings | montore-recordings |
| **GitHub ãƒªãƒã‚¸ãƒˆãƒª** | gmhata/webapp | gmhata/montore |
| **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** | /home/user/webapp | /home/user/montore |

### ç‹¬ç«‹æ€§ã®ä¿è¨¼

- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: å®Œå…¨ã«åˆ¥ã®Firestoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- âœ… **èªè¨¼**: åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã€åˆ¥ã®èªè¨¼è¨­å®š
- âœ… **API Key**: åˆ¥ã®Firebase API Keyï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†é›¢ï¼‰
- âœ… **ãƒ‡ãƒ—ãƒ­ã‚¤**: åˆ¥ã®Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã€åˆ¥ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸
- âœ… **ã‚³ã‚¹ãƒˆ**: åˆ¥ã®èª²é‡‘ã€åˆ¥ã®åˆ©ç”¨çµ±è¨ˆ
- âœ… **Secretç®¡ç†**: åˆ¥ã®OpenAI APIã‚­ãƒ¼ï¼ˆæ¨å¥¨ï¼‰

Ver3ã§å®Ÿè¨¼ã•ã‚ŒãŸæ©Ÿèƒ½ã¨è¨­è¨ˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã€æ–°æ©Ÿèƒ½ã®å®Ÿé¨“ã¨é–‹ç™ºã‚’è¡Œã„ã¾ã™ã€‚**Ver4ã®é–‹ç™ºã‚„éšœå®³ãŒVer3ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**

## ğŸ‰ Ver4.00ã®ç‰¹å¾´

- Ver3.57ã®å®‰å®šæ€§ã‚’ç¶™æ‰¿
- å®Œå…¨ç‹¬ç«‹ç’°å¢ƒã§ã®é‹ç”¨
- æ–°æ©Ÿèƒ½ã®è¿½åŠ æº–å‚™å®Œäº†
- ã‚¯ãƒªãƒ¼ãƒ³ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
